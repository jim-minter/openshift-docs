<!DOCTYPE html>
<!--[if IE 8]> <html class="ie8"> <![endif]-->
<!--[if IE 9]> <html class="ie9"> <![endif]-->
<!--[if gt IE 9]><!-->
<html>
<!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Host-level tasks | Day Two Operations Guide | OpenShift Origin Branch Build</title>
  <link href="https://assets.openshift.net/content/subdomain.css" rel="stylesheet" type="text/css">
  <link href="../../go-client-preview/_stylesheets/docs.css" rel="stylesheet" />
  <link href="../../go-client-preview/_stylesheets/search.css" rel="stylesheet" />
  <link href="https://assets.openshift.net/content/subdomain/touch-icon-precomposed.png" rel="apple-touch-icon-precomposed" type="image/png">
  <link href="https://assets.openshift.net/content/subdomain/favicon32x32.png" rel="shortcut icon" type="text/css">
  <!--[if IE]><link rel="shortcut icon" href="https://assets.openshift.net/content/subdomain/favicon.ico"><![endif]-->
  <!-- or, set /favicon.ico for IE10 win -->
  <meta content="OpenShift" name="application-name">
  <meta content="#000000" name="msapplication-TileColor">
  <meta content="https://assets.openshift.net/content/subdomain/touch-icon-precomposed.png" name="msapplication-TileImage">
  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="https://assets.openshift.net/content/html5shiv.js" type="text/javascript"></script>
    <script src="https://assets.openshift.net/content/respond.js" type="text/javascript"></script>
    <link href="https://assets.openshift.net/content/vendor/respond-js/respond-proxy.html" id="respond-proxy" rel="respond-proxy">
    <link href="../../go-client-preview/_images/respond.proxy.gif" id="respond-redirect" rel="respond-redirect">
    <script src="../../go-client-preview/_javascripts/respond.proxy.js" type="text/javascript"></script>
  <![endif]-->
  <script src="https://assets.openshift.net/content/modernizr.js" type="text/javascript"></script>
  <script src="https://assets.openshift.net/content/subdomain.js" type="text/javascript"></script>
  <script src="../../go-client-preview/_javascripts/bootstrap-offcanvas.js" type="text/javascript"></script>
  <script src="../../go-client-preview/_javascripts/reformat-html.js" type="text/javascript"></script>
  <script src="../../go-client-preview/_javascripts/hc-search.js" type="text/javascript"></script>
  <script async src="//www.google-analytics.com/analytics.js" type="text/javascript"></script>
<script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-40375612-1', 'openshift.org');
  ga('set', 'forceSSL', true);
  ga('send', 'pageview');
</script>
</head>
<body>
  <div class="navbar navbar-default navbar-openshift navbar-origin" role="navigation">
  <div class="navbar-header">
    <a class="navbar-brand origin" href="/"></a>
  </div>
</div>
  <div class="container">
    <p class="toggle-nav visible-xs pull-left">
      <button class="btn btn-default btn-sm" type="button" data-toggle="offcanvas">Toggle nav</button>
    </p>
    <ol class="breadcrumb">
      <li class="sitename">
        <a href="../../index.html">Documentation</a>
      </li>
      <li class="hidden-xs active">
        <a href="../welcome/index.html">OpenShift Origin Branch Build</a>
      </li>
      <li class="hidden-xs active">
        <a href="../day_two_guide/index.html">Day Two Operations Guide</a>
      </li>
      
      <li class="hidden-xs active">
        Host-level tasks
      </li>
    </ol>
    <div class="row row-offcanvas row-offcanvas-left">
      <div class="col-xs-8 col-sm-3 col-md-3 sidebar sidebar-offcanvas">
        <div class="row-fluid">
          <div id="hc-search">
  <input id="hc-search-input" type="text">
  <button id="hc-search-btn">Search</button>
</div>

<div id="hc-search-modal">
  <div id="hc-modal-content">
    <span id="hc-modal-close">&times;</span>
    <div id="hc-search-results"></div>
  </div>
</div>

<script>
  hcSearchCategory("docs_origin", "Branch Build");
</script>
        </div>
        <ul class="nav nav-sidebar">
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup0">
        <span id="tgSpan0" class="fa fa-angle-right"></span>About
      </a>
      <ul id="topicGroup0" class="collapse  list-unstyled">
            <li><a class="" href="../welcome/index.html">Welcome</a></li>
            <li><a class="" href="../welcome/legal_notice.html">Legal Notice</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup1">
        <span id="tgSpan1" class="fa fa-angle-right"></span>What's New?
      </a>
      <ul id="topicGroup1" class="collapse  list-unstyled">
            <li><a class="" href="../whats_new/index.html">Overview</a></li>
            <li><a class="" href="../whats_new/applications.html">Applications</a></li>
            <li><a class="" href="../whats_new/carts_vs_images.html">Cartridges vs Images</a></li>
            <li><a class="" href="../whats_new/terminology.html">Terminology</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup2">
        <span id="tgSpan2" class="fa fa-angle-right"></span>Getting Started
      </a>
      <ul id="topicGroup2" class="collapse  list-unstyled">
            <li><a class="" href="../getting_started/index.html">Overview</a></li>
            <li><a class="" href="../getting_started/developers_console.html">Web Console Walkthrough</a></li>
            <li><a class="" href="../getting_started/developers_cli.html">Command-Line Walkthrough</a></li>
            <li><a class="" href="../getting_started/administrators.html">Setting Up a Cluster</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup3">
        <span id="tgSpan3" class="fa fa-angle-right"></span>Architecture
      </a>
      <ul id="topicGroup3" class="collapse  list-unstyled">
            <li><a class="" href="../architecture/index.html">Overview</a></li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-3-1">
                <span id="sgSpan-3-1" class="fa fa-caret-right"></span>&nbsp;Infrastructure Components
              </a>
              <ul id="topicSubGroup-3-1" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../architecture/infrastructure_components/kubernetes_infrastructure.html">Kubernetes Infrastructure</a></li>
                  <li><a class="" href="../architecture/infrastructure_components/image_registry.html">Container Registry</a></li>
                  <li><a class="" href="../architecture/infrastructure_components/web_console.html">Web Console</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-3-2">
                <span id="sgSpan-3-2" class="fa fa-caret-right"></span>&nbsp;Core Concepts
              </a>
              <ul id="topicSubGroup-3-2" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../architecture/core_concepts/index.html">Overview</a></li>
                  <li><a class="" href="../architecture/core_concepts/containers_and_images.html">Containers and Images</a></li>
                  <li><a class="" href="../architecture/core_concepts/pods_and_services.html">Pods and Services</a></li>
                  <li><a class="" href="../architecture/core_concepts/projects_and_users.html">Projects and Users</a></li>
                  <li><a class="" href="../architecture/core_concepts/builds_and_image_streams.html">Builds and Image Streams</a></li>
                  <li><a class="" href="../architecture/core_concepts/deployments.html">Deployments</a></li>
                  <li><a class="" href="../architecture/core_concepts/templates.html">Templates</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-3-3">
                <span id="sgSpan-3-3" class="fa fa-caret-right"></span>&nbsp;Additional Concepts
              </a>
              <ul id="topicSubGroup-3-3" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../architecture/additional_concepts/authentication.html">Authentication</a></li>
                  <li><a class="" href="../architecture/additional_concepts/authorization.html">Authorization</a></li>
                  <li><a class="" href="../architecture/additional_concepts/storage.html">Persistent Storage</a></li>
                  <li><a class="" href="../architecture/additional_concepts/scm.html">Source Control Management</a></li>
                  <li><a class="" href="../architecture/additional_concepts/admission_controllers.html">Admission Controllers</a></li>
                  <li><a class="" href="../architecture/additional_concepts/other_api_objects.html">Other API Objects</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-3-4">
                <span id="sgSpan-3-4" class="fa fa-caret-right"></span>&nbsp;Networking
              </a>
              <ul id="topicSubGroup-3-4" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../architecture/networking/networking.html">Networking</a></li>
                  <li><a class="" href="../architecture/networking/sdn.html">OpenShift SDN</a></li>
                  <li><a class="" href="../architecture/networking/network_plugins.html">Network Plug-ins</a></li>
                  <li><a class="" href="../architecture/networking/port_forwarding.html">Port Forwarding</a></li>
                  <li><a class="" href="../architecture/networking/remote_commands.html">Remote Commands</a></li>
                  <li><a class="" href="../architecture/networking/haproxy-router.html">HAProxy Router Plug-in</a></li>
                  <li><a class="" href="../architecture/networking/routes.html">Routes</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-3-5">
                <span id="sgSpan-3-5" class="fa fa-caret-right"></span>&nbsp;Service Catalog Components
              </a>
              <ul id="topicSubGroup-3-5" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../architecture/service_catalog/index.html">Service Catalog</a></li>
                  <li><a class="" href="../architecture/service_catalog/template_service_broker.html">Template Service Broker</a></li>
                  <li><a class="" href="../architecture/service_catalog/ansible_service_broker.html">OpenShift Ansible Broker</a></li>
              </ul>
            </li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup4">
        <span id="tgSpan4" class="fa fa-angle-right"></span>Container Security Guide
      </a>
      <ul id="topicGroup4" class="collapse  list-unstyled">
            <li><a class="" href="../security/index.html">Introduction</a></li>
            <li><a class="" href="../security/hosts_multitenancy.html">Container Hosts and Multi-tenancy</a></li>
            <li><a class="" href="../security/container_content.html">Container Content</a></li>
            <li><a class="" href="../security/registries.html">Registries</a></li>
            <li><a class="" href="../security/build_process.html">Build Process</a></li>
            <li><a class="" href="../security/deployment.html">Deployment</a></li>
            <li><a class="" href="../security/securing_container_platform.html">Securing the Container Platform</a></li>
            <li><a class="" href="../security/network_security.html">Network Security</a></li>
            <li><a class="" href="../security/storage.html">Attached Storage</a></li>
            <li><a class="" href="../security/monitoring.html">Monitoring Events and Logs</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup5">
        <span id="tgSpan5" class="fa fa-angle-right"></span>Installation and Configuration
      </a>
      <ul id="topicGroup5" class="collapse  list-unstyled">
            <li><a class="" href="../install_config/index.html">Overview</a></li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-5-1">
                <span id="sgSpan-5-1" class="fa fa-caret-right"></span>&nbsp;Installing a Cluster
              </a>
              <ul id="topicSubGroup-5-1" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../install_config/install/planning.html">Planning</a></li>
                  <li><a class="" href="../install_config/install/prerequisites.html">Prerequisites</a></li>
                  <li><a class="" href="../install_config/install/host_preparation.html">Host Preparation</a></li>
                  <li><a class="" href="../install_config/install/rpm_vs_containerized.html">Installing on Containerized Hosts</a></li>
                  <li><a class="" href="../install_config/install/quick_install.html">Quick Installation</a></li>
                  <li><a class="" href="../install_config/install/advanced_install.html">Advanced Installation</a></li>
                  <li><a class="" href="../install_config/install/stand_alone_registry.html">Installing a Stand-alone Deployment of OpenShift Container Registry</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-5-2">
                <span id="sgSpan-5-2" class="fa fa-caret-right"></span>&nbsp;Setting up the Registry
              </a>
              <ul id="topicSubGroup-5-2" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../install_config/registry/index.html">Registry Overview</a></li>
                  <li><a class="" href="../install_config/registry/deploy_registry_existing_clusters.html">Deploying a Registry on Existing Clusters</a></li>
                  <li><a class="" href="../install_config/registry/accessing_registry.html">Accessing the Registry</a></li>
                  <li><a class="" href="../install_config/registry/securing_and_exposing_registry.html">Securing and Exposing the Registry</a></li>
                  <li><a class="" href="../install_config/registry/extended_registry_configuration.html">Extended Registry Configuration</a></li>
                  <li><a class="" href="../install_config/registry/registry_known_issues.html">Known Issues</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-5-3">
                <span id="sgSpan-5-3" class="fa fa-caret-right"></span>&nbsp;Setting up a Router
              </a>
              <ul id="topicSubGroup-5-3" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../install_config/router/index.html">Router Overview</a></li>
                  <li><a class="" href="../install_config/router/default_haproxy_router.html">Using the Default HAProxy Router</a></li>
                  <li><a class="" href="../install_config/router/customized_haproxy_router.html">Deploying a Customized HAProxy Router</a></li>
                  <li><a class="" href="../install_config/router/proxy_protocol.html">Configuring the HAProxy Router to Use the PROXY Protocol</a></li>
                  <li><a class="" href="../install_config/router/f5_router.html">Using the F5 Router Plug-in</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-5-4">
                <span id="sgSpan-5-4" class="fa fa-caret-right"></span>&nbsp;Upgrading a Cluster
              </a>
              <ul id="topicSubGroup-5-4" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../install_config/upgrading/index.html">Overview</a></li>
                  <li><a class="" href="../install_config/upgrading/automated_upgrades.html">Automated In-place Upgrades</a></li>
                  <li><a class="" href="../install_config/upgrading/manual_upgrades.html">Manual In-place Upgrades</a></li>
                  <li><a class="" href="../install_config/upgrading/blue_green_deployments.html">Blue-Green Deployments</a></li>
                  <li><a class="" href="../install_config/upgrading/os_upgrades.html">Operating System Updates and Upgrades</a></li>
                  <li><a class="" href="../install_config/upgrading/migrating_embedded_etcd.html">Migrating Embedded etcd to External etcd</a></li>
                  <li><a class="" href="../install_config/upgrading/migrating_etcd.html">Migrating etcd Data (v2 to v3)</a></li>
              </ul>
            </li>
            <li><a class="" href="../install_config/master_node_configuration.html">Master and Node Configuration</a></li>
            <li><a class="" href="../install_config/oab_broker_configuration.html">OpenShift Ansible Broker Configuration</a></li>
            <li><a class="" href="../install_config/adding_hosts_to_existing_cluster.html">Adding Hosts to an Existing Cluster</a></li>
            <li><a class="" href="../install_config/imagestreams_templates.html">Loading the Default Image Streams and Templates</a></li>
            <li><a class="" href="../install_config/certificate_customization.html">Configuring Custom Certificates</a></li>
            <li><a class="" href="../install_config/redeploying_certificates.html">Redeploying Certificates</a></li>
            <li><a class="" href="../install_config/configuring_authentication.html">Configuring Authentication and User Agent</a></li>
            <li><a class="" href="../install_config/syncing_groups_with_ldap.html">Syncing Groups With LDAP</a></li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-5-13">
                <span id="sgSpan-5-13" class="fa fa-caret-right"></span>&nbsp;Advanced LDAP Configuration
              </a>
              <ul id="topicSubGroup-5-13" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../install_config/advanced_ldap_configuration/index.html">Overview</a></li>
                  <li><a class="" href="../install_config/advanced_ldap_configuration/sssd_for_ldap_failover.html">Setting up SSSD for LDAP Failover</a></li>
                  <li><a class="" href="../install_config/advanced_ldap_configuration/configuring_form_based_authentication.html">Configuring Form-Based Authentication</a></li>
                  <li><a class="" href="../install_config/advanced_ldap_configuration/configuring_extended_ldap_attributes.html">Configuring Extended LDAP Attributes</a></li>
              </ul>
            </li>
            <li><a class="" href="../install_config/configuring_sdn.html">Configuring the SDN</a></li>
            <li><a class="" href="../install_config/configuring_nuagesdn.html">Configuring Nuage SDN</a></li>
            <li><a class="" href="../install_config/configuring_kuryrsdn.html">Configuring Kuryr SDN</a></li>
            <li><a class="" href="../install_config/configuring_aws.html">Configuring for AWS</a></li>
            <li><a class="" href="../install_config/configuring_openstack.html">Configuring for OpenStack</a></li>
            <li><a class="" href="../install_config/configuring_gce.html">Configuring for GCE</a></li>
            <li><a class="" href="../install_config/configuring_azure.html">Configuring for Azure</a></li>
            <li><a class="" href="../install_config/configuring_vsphere.html">Configuring for VMWare vSphere</a></li>
            <li><a class="" href="../install_config/configuring_local.html">Configuring for local Volume</a></li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-5-23">
                <span id="sgSpan-5-23" class="fa fa-caret-right"></span>&nbsp;Configuring Persistent Storage
              </a>
              <ul id="topicSubGroup-5-23" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../install_config/persistent_storage/index.html">Overview</a></li>
                  <li><a class="" href="../install_config/persistent_storage/persistent_storage_nfs.html">Using NFS</a></li>
                  <li><a class="" href="../install_config/persistent_storage/persistent_storage_glusterfs.html">Using GlusterFS</a></li>
                  <li><a class="" href="../install_config/persistent_storage/persistent_storage_cinder.html">Using OpenStack Cinder</a></li>
                  <li><a class="" href="../install_config/persistent_storage/persistent_storage_ceph_rbd.html">Using Ceph RBD</a></li>
                  <li><a class="" href="../install_config/persistent_storage/persistent_storage_aws.html">Using AWS Elastic Block Store</a></li>
                  <li><a class="" href="../install_config/persistent_storage/persistent_storage_gce.html">Using GCE Persistent Disk</a></li>
                  <li><a class="" href="../install_config/persistent_storage/persistent_storage_iscsi.html">Using iSCSI</a></li>
                  <li><a class="" href="../install_config/persistent_storage/persistent_storage_fibre_channel.html">Using Fibre Channel</a></li>
                  <li><a class="" href="../install_config/persistent_storage/persistent_storage_azure.html">Using Azure Disk</a></li>
                  <li><a class="" href="../install_config/persistent_storage/persistent_storage_azure_file.html">Using Azure File</a></li>
                  <li><a class="" href="../install_config/persistent_storage/persistent_storage_flex_volume.html">Using FlexVolume</a></li>
                  <li><a class="" href="../install_config/persistent_storage/persistent_storage_vsphere.html">Using VMWare vSphere</a></li>
                  <li><a class="" href="../install_config/persistent_storage/persistent_storage_local.html">Using Local Volume</a></li>
                  <li><a class="" href="../install_config/persistent_storage/dynamically_provisioning_pvs.html">Dynamic Provisioning and Creating Storage Classes</a></li>
                  <li><a class="" href="../install_config/persistent_storage/pod_security_context.html">Volume Security</a></li>
                  <li><a class="" href="../install_config/persistent_storage/selector_label_binding.html">Selector-Label Volume Binding</a></li>
                  <li><a class="" href="../install_config/persistent_storage/enabling_controller_attach_detach.html">Enabling Controller-managed Attachment and Detachment</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-5-24">
                <span id="sgSpan-5-24" class="fa fa-caret-right"></span>&nbsp;Persistent Storage Examples
              </a>
              <ul id="topicSubGroup-5-24" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../install_config/storage_examples/index.html">Overview</a></li>
                  <li><a class="" href="../install_config/storage_examples/shared_storage.html">Sharing an NFS PV Across Two Pods</a></li>
                  <li><a class="" href="../install_config/storage_examples/ceph_example.html">Complete Example Using Ceph RBD</a></li>
                  <li><a class="" href="../install_config/storage_examples/ceph_rbd_dynamic_example.html">Complete Example Using Ceph RBD for Dynamic Provisioning</a></li>
                  <li><a class="" href="../install_config/storage_examples/gluster_example.html">Complete Example Using GlusterFS</a></li>
                  <li><a class="" href="../install_config/storage_examples/gluster_dynamic_example.html">Dynamic Provisioning Example Using Containerized GlusterFS</a></li>
                  <li><a class="" href="../install_config/storage_examples/dedicated_gluster_dynamic_example.html">Dynamic Provisioning Example Using Dedicated GlusterFS</a></li>
                  <li><a class="" href="../install_config/storage_examples/containerized_heketi_with_dedicated_gluster.html">Containerized Heketi for Managing Dedicated GlusterFS</a></li>
                  <li><a class="" href="../install_config/storage_examples/privileged_pod_storage.html">Mounting Volumes To Privileged Pods</a></li>
                  <li><a class="" href="../install_config/storage_examples/gluster_backed_registry.html">Backing Docker Registry with GlusterFS Storage</a></li>
                  <li><a class="" href="../install_config/storage_examples/binding_pv_by_label.html">Binding Persistent Volumes by Label</a></li>
                  <li><a class="" href="../install_config/storage_examples/storage_classes_dynamic_provisioning.html">Using StorageClasses for Dynamic Provisioning</a></li>
                  <li><a class="" href="../install_config/storage_examples/storage_classes_legacy.html">Using StorageClasses for Existing Legacy Storage</a></li>
                  <li><a class="" href="../install_config/storage_examples/azure_blob_docker_registry_example.html">Configuring Azure Blob Storage for Integrated Docker Registry</a></li>
              </ul>
            </li>
            <li><a class="" href="../install_config/http_proxies.html">Working with HTTP Proxies</a></li>
            <li><a class="" href="../install_config/build_defaults_overrides.html">Configuring Global Build Defaults and Overrides</a></li>
            <li><a class="" href="../install_config/configuring_pipeline_execution.html">Configuring Pipeline Execution</a></li>
            <li><a class="" href="../install_config/configuring_routing.html">Configuring Route Timeouts</a></li>
            <li><a class="" href="../install_config/configuring_native_container_routing.html">Configuring Native Container Routing</a></li>
            <li><a class="" href="../install_config/routing_from_edge_lb.html">Routing from Edge Load Balancers</a></li>
            <li><a class="" href="../install_config/aggregate_logging.html">Aggregating Container Logs</a></li>
            <li><a class="" href="../install_config/aggregate_logging_sizing.html">Aggregate Logging Sizing Guidelines</a></li>
            <li><a class="" href="../install_config/cluster_metrics.html">Enabling Cluster Metrics</a></li>
            <li><a class="" href="../install_config/web_console_customization.html">Customizing the Web Console</a></li>
            <li><a class="" href="../install_config/provisioners.html">Deploying External Persistent Volume Provisioners</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup6">
        <span id="tgSpan6" class="fa fa-angle-down"></span>Day Two Operations Guide
      </a>
      <ul id="topicGroup6" class="collapse in list-unstyled">
            <li><a class="" href="../day_two_guide/index.html">Overview</a></li>
            <li><a class="" href="../day_two_guide/run_once_tasks.html">Run-once tasks</a></li>
            <li><a class="" href="../day_two_guide/environment_health_checks.html">Environment health checks</a></li>
            <li><a class=" active" href="../day_two_guide/host_level_tasks.html">Host-level tasks</a></li>
            <li><a class="" href="../day_two_guide/project_level_tasks.html">Project-level tasks</a></li>
            <li><a class="" href="../day_two_guide/docker_tasks.html">Docker tasks</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup7">
        <span id="tgSpan7" class="fa fa-angle-right"></span>Cluster Administration
      </a>
      <ul id="topicGroup7" class="collapse  list-unstyled">
            <li><a class="" href="../admin_guide/index.html">Overview</a></li>
            <li><a class="" href="../admin_guide/manage_nodes.html">Managing Nodes</a></li>
            <li><a class="" href="../admin_guide/manage_users.html">Managing Users</a></li>
            <li><a class="" href="../admin_guide/managing_projects.html">Managing Projects</a></li>
            <li><a class="" href="../admin_guide/managing_pods.html">Managing Pods</a></li>
            <li><a class="" href="../admin_guide/managing_networking.html">Managing Networking</a></li>
            <li><a class="" href="../admin_guide/service_accounts.html">Configuring Service Accounts</a></li>
            <li><a class="" href="../admin_guide/manage_rbac.html">Managing Role-based Access Control</a></li>
            <li><a class="" href="../admin_guide/image_policy.html">Image Policy</a></li>
            <li><a class="" href="../admin_guide/image_signatures.html">Image Signatures</a></li>
            <li><a class="" href="../admin_guide/scoped_tokens.html">Scoped Tokens</a></li>
            <li><a class="" href="../admin_guide/monitoring_images.html">Monitoring Images</a></li>
            <li><a class="" href="../admin_guide/manage_scc.html">Managing Security Context Constraints</a></li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-7-13">
                <span id="sgSpan-7-13" class="fa fa-caret-right"></span>&nbsp;Scheduling
              </a>
              <ul id="topicSubGroup-7-13" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../admin_guide/scheduling/index.html">Overview</a></li>
                  <li><a class="" href="../admin_guide/scheduling/scheduler.html">Default Scheduling</a></li>
                  <li><a class="" href="../admin_guide/scheduling/custom_scheduler.html">Custom Scheduling</a></li>
                  <li><a class="" href="../admin_guide/scheduling/scheduler-advanced.html">Advanced Scheduling</a></li>
                  <li><a class="" href="../admin_guide/scheduling/node_affinity.html">Advanced Scheduling and Node Affinity</a></li>
                  <li><a class="" href="../admin_guide/scheduling/pod_affinity.html">Advanced Scheduling and Pod Affinity/Anti-affinity</a></li>
                  <li><a class="" href="../admin_guide/scheduling/node_selector.html">Advanced Scheduling and Node Selectors</a></li>
                  <li><a class="" href="../admin_guide/scheduling/taints_tolerations.html">Advanced Scheduling and Taints and Tolerations</a></li>
              </ul>
            </li>
            <li><a class="" href="../admin_guide/quota.html">Setting Quotas</a></li>
            <li><a class="" href="../admin_guide/multiproject_quota.html">Setting Multi-Project Quotas</a></li>
            <li><a class="" href="../admin_guide/limits.html">Setting Limit Ranges</a></li>
            <li><a class="" href="../admin_guide/pruning_resources.html">Pruning Objects</a></li>
            <li><a class="" href="../admin_guide/custom_resource_definitions.html">Extending the Kubernetes API with Custom Resources</a></li>
            <li><a class="" href="../admin_guide/garbage_collection.html">Garbage Collection</a></li>
            <li><a class="" href="../admin_guide/allocating_node_resources.html">Allocating Node Resources</a></li>
            <li><a class="" href="../admin_guide/opaque_integer_resources.html">Opaque Integer Resources</a></li>
            <li><a class="" href="../admin_guide/overcommit.html">Overcommitting</a></li>
            <li><a class="" href="../admin_guide/tcp_ingress_external_ports.html">Assigning Unique External IPs for Ingress Traffic</a></li>
            <li><a class="" href="../admin_guide/out_of_resource_handling.html">Out of Resource Handling</a></li>
            <li><a class="" href="../admin_guide/router.html">Monitoring and Debugging Routers</a></li>
            <li><a class="" href="../admin_guide/high_availability.html">High Availability</a></li>
            <li><a class="" href="../admin_guide/iptables.html">IPtables</a></li>
            <li><a class="" href="../admin_guide/securing_builds.html">Securing Builds by Strategy</a></li>
            <li><a class="" href="../admin_guide/seccomp.html">Restricting Application Capabilities Using Seccomp</a></li>
            <li><a class="" href="../admin_guide/sysctls.html">Sysctls</a></li>
            <li><a class="" href="../admin_guide/encrypting_data.html">Encrypting Data at Datastore Layer</a></li>
            <li><a class="" href="../admin_guide/ipsec.html">Encrypting Hosts with IPsec</a></li>
            <li><a class="" href="../admin_guide/building_dependency_trees.html">Building Dependency Trees</a></li>
            <li><a class="" href="../admin_guide/backup_restore.html">Backup and Restore</a></li>
            <li><a class="" href="../admin_guide/sdn_troubleshooting.html">Troubleshooting Networking</a></li>
            <li><a class="" href="../admin_guide/diagnostics_tool.html">Diagnostics Tool</a></li>
            <li><a class="" href="../admin_guide/idling_applications.html">Idling Applications</a></li>
            <li><a class="" href="../admin_guide/cluster_capacity.html">Analyzing Cluster Capacity</a></li>
            <li><a class="" href="../admin_guide/kuryr.html">Kuryr SDN Administration</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup8">
        <span id="tgSpan8" class="fa fa-angle-right"></span>Scaling and Performance Guide
      </a>
      <ul id="topicGroup8" class="collapse  list-unstyled">
            <li><a class="" href="../scaling_performance/index.html">Overview</a></li>
            <li><a class="" href="../scaling_performance/install_practices.html">Recommended Installation Practices</a></li>
            <li><a class="" href="../scaling_performance/host_practices.html">Recommended Host Practices</a></li>
            <li><a class="" href="../scaling_performance/optimizing_compute_resources.html">Optimizing Compute Resources</a></li>
            <li><a class="" href="../scaling_performance/optimizing_storage.html">Optimizing Storage</a></li>
            <li><a class="" href="../scaling_performance/network_optimization.html">Network Optimization</a></li>
            <li><a class="" href="../scaling_performance/routing_optimization.html">Routing Optimization</a></li>
            <li><a class="" href="../scaling_performance/scaling_cluster_metrics.html">Scaling Cluster Metrics</a></li>
            <li><a class="" href="../scaling_performance/cluster_limits.html">Cluster Limits</a></li>
            <li><a class="" href="../scaling_performance/using_cluster_loader.html">Using Cluster Loader</a></li>
            <li><a class="" href="../scaling_performance/using_cpu_manager.html">Using CPU Manager</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup9">
        <span id="tgSpan9" class="fa fa-angle-right"></span>CLI Reference
      </a>
      <ul id="topicGroup9" class="collapse  list-unstyled">
            <li><a class="" href="../cli_reference/index.html">Overview</a></li>
            <li><a class="" href="../cli_reference/get_started_cli.html">Get Started with the CLI</a></li>
            <li><a class="" href="../cli_reference/manage_cli_profiles.html">Managing CLI Profiles</a></li>
            <li><a class="" href="../cli_reference/basic_cli_operations.html">Developer CLI Operations</a></li>
            <li><a class="" href="../cli_reference/admin_cli_operations.html">Administrator CLI Operations</a></li>
            <li><a class="" href="../cli_reference/extend_cli.html">Extending the CLI</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup10">
        <span id="tgSpan10" class="fa fa-angle-right"></span>Developer Guide
      </a>
      <ul id="topicGroup10" class="collapse  list-unstyled">
            <li><a class="" href="../dev_guide/index.html">Overview</a></li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-10-1">
                <span id="sgSpan-10-1" class="fa fa-caret-right"></span>&nbsp;Application Life Cycle Management
              </a>
              <ul id="topicSubGroup-10-1" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../dev_guide/application_lifecycle/development_process.html">Planning Your Development Process</a></li>
                  <li><a class="" href="../dev_guide/application_lifecycle/new_app.html">Creating New Applications</a></li>
                  <li><a class="" href="../dev_guide/application_lifecycle/promoting_applications.html">Promoting Applications Across Environments</a></li>
              </ul>
            </li>
            <li><a class="" href="../dev_guide/authentication.html">Authentication</a></li>
            <li><a class="" href="../dev_guide/authorization.html">Authorization</a></li>
            <li><a class="" href="../dev_guide/projects.html">Projects</a></li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-10-5">
                <span id="sgSpan-10-5" class="fa fa-caret-right"></span>&nbsp;Migrating Applications
              </a>
              <ul id="topicSubGroup-10-5" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../dev_guide/migrating_applications/index.html">Overview</a></li>
                  <li><a class="" href="../dev_guide/migrating_applications/database_applications.html">Database Applications</a></li>
                  <li><a class="" href="../dev_guide/migrating_applications/web_framework_applications.html">Web Framework Applications</a></li>
                  <li><a class="" href="../dev_guide/migrating_applications/quickstart_examples.html">QuickStart Examples</a></li>
                  <li><a class="" href="../dev_guide/migrating_applications/continuous_integration_and_deployment.html">Continuous Integration and Deployment</a></li>
                  <li><a class="" href="../dev_guide/migrating_applications/web_hooks_action_hooks.html">Webhooks and Action Hooks</a></li>
                  <li><a class="" href="../dev_guide/migrating_applications/S2I_tool.html">S2I Tool</a></li>
                  <li><a class="" href="../dev_guide/migrating_applications/support_guide.html">Support Guide</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-10-6">
                <span id="sgSpan-10-6" class="fa fa-caret-right"></span>&nbsp;Tutorials
              </a>
              <ul id="topicSubGroup-10-6" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../dev_guide/dev_tutorials/index.html">Overview</a></li>
                  <li><a class="" href="../dev_guide/dev_tutorials/quickstarts.html">Quickstart Templates</a></li>
                  <li><a class="" href="../dev_guide/dev_tutorials/ruby_on_rails.html">Ruby on Rails</a></li>
                  <li><a class="" href="../dev_guide/dev_tutorials/maven_tutorial.html">Setting Up a Nexus Mirror</a></li>
                  <li><a class="" href="../dev_guide/dev_tutorials/openshift_pipeline.html">OpenShift Pipeline Builds</a></li>
                  <li><a class="" href="../dev_guide/dev_tutorials/binary_builds.html">Binary Builds</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-10-7">
                <span id="sgSpan-10-7" class="fa fa-caret-right"></span>&nbsp;Builds
              </a>
              <ul id="topicSubGroup-10-7" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../dev_guide/builds/index.html">How Builds Work</a></li>
                  <li><a class="" href="../dev_guide/builds/basic_build_operations.html">Basic Build Operations</a></li>
                  <li><a class="" href="../dev_guide/builds/build_inputs.html">Build Inputs</a></li>
                  <li><a class="" href="../dev_guide/builds/build_output.html">Build Output</a></li>
                  <li><a class="" href="../dev_guide/builds/build_strategies.html">Build Strategy Options</a></li>
                  <li><a class="" href="../dev_guide/builds/build_environment.html">Build Environment</a></li>
                  <li><a class="" href="../dev_guide/builds/triggering_builds.html">Triggering Builds</a></li>
                  <li><a class="" href="../dev_guide/builds/build_hooks.html">Build Hooks</a></li>
                  <li><a class="" href="../dev_guide/builds/build_run_policy.html">Build Run Policy</a></li>
                  <li><a class="" href="../dev_guide/builds/advanced_build_operations.html">Advanced Build Operations</a></li>
                  <li><a class="" href="../dev_guide/builds/build_troubleshooting.html">Troubleshooting</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-10-8">
                <span id="sgSpan-10-8" class="fa fa-caret-right"></span>&nbsp;Deployments
              </a>
              <ul id="topicSubGroup-10-8" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../dev_guide/deployments/how_deployments_work.html">How Deployments Work</a></li>
                  <li><a class="" href="../dev_guide/deployments/basic_deployment_operations.html">Basic Deployment Operations</a></li>
                  <li><a class="" href="../dev_guide/deployments/deployment_strategies.html">Deployment Strategies</a></li>
                  <li><a class="" href="../dev_guide/deployments/advanced_deployment_strategies.html">Advanced Deployment Strategies</a></li>
                  <li><a class="" href="../dev_guide/deployments/kubernetes_deployments.html">Kubernetes Deployments Support</a></li>
              </ul>
            </li>
            <li><a class="" href="../dev_guide/templates.html">Templates</a></li>
            <li><a class="" href="../dev_guide/ssh_environment.html">Opening a Remote Shell to Containers</a></li>
            <li><a class="" href="../dev_guide/service_accounts.html">Service Accounts</a></li>
            <li><a class="" href="../dev_guide/managing_images.html">Managing Images</a></li>
            <li><a class="" href="../dev_guide/compute_resources.html">Quotas and Limit Ranges</a></li>
            <li><a class="" href="../dev_guide/pod_preset.html">Injecting Information into Pods Using Pod Presets</a></li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-10-15">
                <span id="sgSpan-10-15" class="fa fa-caret-right"></span>&nbsp;Getting Traffic into a Cluster over Non-Standard Ports
              </a>
              <ul id="topicSubGroup-10-15" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../dev_guide/expose_service/index.html">Overview</a></li>
                  <li><a class="" href="../dev_guide/expose_service/expose_internal_ip_router.html">Using a Router</a></li>
                  <li><a class="" href="../dev_guide/expose_service/expose_internal_ip_load_balancer.html">Using a Load Balancer</a></li>
                  <li><a class="" href="../dev_guide/expose_service/expose_internal_ip_service.html">Using a Service ExternalIP</a></li>
                  <li><a class="" href="../dev_guide/expose_service/expose_internal_ip_nodeport.html">Using a NodePort</a></li>
              </ul>
            </li>
            <li><a class="" href="../dev_guide/routes.html">Routes</a></li>
            <li><a class="" href="../dev_guide/integrating_external_services.html">Integrating External Services</a></li>
            <li><a class="" href="../dev_guide/secrets.html">Secrets</a></li>
            <li><a class="" href="../dev_guide/configmaps.html">ConfigMaps</a></li>
            <li><a class="" href="../dev_guide/downward_api.html">Downward API</a></li>
            <li><a class="" href="../dev_guide/projected_volumes.html">Projected Volumes</a></li>
            <li><a class="" href="../dev_guide/daemonsets.html">Using Daemonsets</a></li>
            <li><a class="" href="../dev_guide/pod_autoscaling.html">Pod Autoscaling</a></li>
            <li><a class="" href="../dev_guide/volumes.html">Managing Volumes</a></li>
            <li><a class="" href="../dev_guide/persistent_volumes.html">Using Persistent Volumes</a></li>
            <li><a class="" href="../dev_guide/executing_remote_commands.html">Executing Remote Commands</a></li>
            <li><a class="" href="../dev_guide/copy_files_to_container.html">Copying Files</a></li>
            <li><a class="" href="../dev_guide/port_forwarding.html">Port Forwarding</a></li>
            <li><a class="" href="../dev_guide/shared_memory.html">Shared Memory</a></li>
            <li><a class="" href="../dev_guide/application_health.html">Application Health</a></li>
            <li><a class="" href="../dev_guide/events.html">Events</a></li>
            <li><a class="" href="../dev_guide/environment_variables.html">Managing Environment Variables</a></li>
            <li><a class="" href="../dev_guide/jobs.html">Jobs</a></li>
            <li><a class="" href="../dev_guide/openshift_pipeline.html">OpenShift Pipeline</a></li>
            <li><a class="" href="../dev_guide/cron_jobs.html">Cron Jobs</a></li>
            <li><a class="" href="../dev_guide/create_from_url.html">Create from URL</a></li>
            <li><a class="" href="../dev_guide/application_memory_sizing.html">Application memory sizing</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup11">
        <span id="tgSpan11" class="fa fa-angle-right"></span>Creating Images
      </a>
      <ul id="topicGroup11" class="collapse  list-unstyled">
            <li><a class="" href="../creating_images/index.html">Overview</a></li>
            <li><a class="" href="../creating_images/guidelines.html">Guidelines</a></li>
            <li><a class="" href="../creating_images/metadata.html">Image Metadata</a></li>
            <li><a class="" href="../creating_images/s2i.html">S2I Requirements</a></li>
            <li><a class="" href="../creating_images/s2i_testing.html">Testing S2I Images</a></li>
            <li><a class="" href="../creating_images/custom.html">Custom Builder</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup12">
        <span id="tgSpan12" class="fa fa-angle-right"></span>Using Images
      </a>
      <ul id="topicGroup12" class="collapse  list-unstyled">
            <li><a class="" href="../using_images/index.html">Overview</a></li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-12-1">
                <span id="sgSpan-12-1" class="fa fa-caret-right"></span>&nbsp;Source-to-Image (S2I)
              </a>
              <ul id="topicSubGroup-12-1" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../using_images/s2i_images/index.html">Overview</a></li>
                  <li><a class="" href="../using_images/s2i_images/nodejs.html">Node.js</a></li>
                  <li><a class="" href="../using_images/s2i_images/perl.html">Perl</a></li>
                  <li><a class="" href="../using_images/s2i_images/php.html">PHP</a></li>
                  <li><a class="" href="../using_images/s2i_images/python.html">Python</a></li>
                  <li><a class="" href="../using_images/s2i_images/ruby.html">Ruby</a></li>
                  <li><a class="" href="../using_images/s2i_images/wildfly.html">Wildfly</a></li>
                  <li><a class="" href="../using_images/s2i_images/customizing_s2i_images.html">Customizing S2I Images</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-12-2">
                <span id="sgSpan-12-2" class="fa fa-caret-right"></span>&nbsp;Database Images
              </a>
              <ul id="topicSubGroup-12-2" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../using_images/db_images/index.html">Overview</a></li>
                  <li><a class="" href="../using_images/db_images/mysql.html">MySQL</a></li>
                  <li><a class="" href="../using_images/db_images/postgresql.html">PostgreSQL</a></li>
                  <li><a class="" href="../using_images/db_images/mongodb.html">MongoDB</a></li>
                  <li><a class="" href="../using_images/db_images/mariadb.html">MariaDB</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-12-3">
                <span id="sgSpan-12-3" class="fa fa-caret-right"></span>&nbsp;Docker Images
              </a>
              <ul id="topicSubGroup-12-3" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../using_images/docker_images/index.html">Overview</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-12-4">
                <span id="sgSpan-12-4" class="fa fa-caret-right"></span>&nbsp;Other Images
              </a>
              <ul id="topicSubGroup-12-4" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../using_images/other_images/index.html">Overview</a></li>
                  <li><a class="" href="../using_images/other_images/jenkins.html">Jenkins</a></li>
                  <li><a class="" href="../using_images/other_images/jenkins_slaves.html">Jenkins Slaves</a></li>
              </ul>
            </li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup13">
        <span id="tgSpan13" class="fa fa-angle-right"></span>Ansible Playbook Bundle Development Guide
      </a>
      <ul id="topicGroup13" class="collapse  list-unstyled">
            <li><a class="" href="../apb_devel/index.html">Introduction</a></li>
            <li><a class="" href="../apb_devel/cli_tooling.html">CLI Tooling</a></li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-13-2">
                <span id="sgSpan-13-2" class="fa fa-caret-right"></span>&nbsp;Writing APBs
              </a>
              <ul id="topicSubGroup-13-2" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../apb_devel/writing/getting_started.html">Getting Started</a></li>
                  <li><a class="" href="../apb_devel/writing/reference.html">Reference</a></li>
              </ul>
            </li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup14">
        <span id="tgSpan14" class="fa fa-angle-right"></span>Go Client Library Reference
      </a>
      <ul id="topicGroup14" class="collapse  list-unstyled">
            <li><a class="" href="../go_client/getting_started.html">Getting Started</a></li>
            <li><a class="" href="../go_client/connecting_to_the_cluster.html">Connecting to the Cluster</a></li>
            <li><a class="" href="../go_client/tracing_api_requests_and_responses.html">Tracing API Requests and Responses</a></li>
            <li><a class="" href="../go_client/standard_api_operations.html">Standard API Operations</a></li>
            <li><a class="" href="../go_client/serializing_and_deserializing.html">Serializing and Deserializing</a></li>
            <li><a class="" href="../go_client/instantiating_templates.html">Instantiating Templates</a></li>
            <li><a class="" href="../go_client/executing_remote_processes.html">Executing Remote Processes</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup15">
        <span id="tgSpan15" class="fa fa-angle-right"></span>REST API Reference
      </a>
      <ul id="topicGroup15" class="collapse  list-unstyled">
            <li><a class="" href="../rest_api/index.html">Overview</a></li>
            <li><a class="" href="../rest_api/examples.html">Examples</a></li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-2">
                <span id="sgSpan-15-2" class="fa fa-caret-right"></span>&nbsp;/api/v1
              </a>
              <ul id="topicSubGroup-15-2" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/api/v1.APIResourceList.html">v1.APIResourceList</a></li>
                  <li><a class="" href="../rest_api/api/v1.APIVersions.html">v1.APIVersions</a></li>
                  <li><a class="" href="../rest_api/api/v1.Binding.html">v1.Binding</a></li>
                  <li><a class="" href="../rest_api/api/v1.ComponentStatus.html">v1.ComponentStatus</a></li>
                  <li><a class="" href="../rest_api/api/v1.ConfigMap.html">v1.ConfigMap</a></li>
                  <li><a class="" href="../rest_api/api/v1.Endpoints.html">v1.Endpoints</a></li>
                  <li><a class="" href="../rest_api/api/v1.Event.html">v1.Event</a></li>
                  <li><a class="" href="../rest_api/api/v1.LimitRange.html">v1.LimitRange</a></li>
                  <li><a class="" href="../rest_api/api/v1.Namespace.html">v1.Namespace</a></li>
                  <li><a class="" href="../rest_api/api/v1.Node.html">v1.Node</a></li>
                  <li><a class="" href="../rest_api/api/v1.PersistentVolume.html">v1.PersistentVolume</a></li>
                  <li><a class="" href="../rest_api/api/v1.PersistentVolumeClaim.html">v1.PersistentVolumeClaim</a></li>
                  <li><a class="" href="../rest_api/api/v1.Pod.html">v1.Pod</a></li>
                  <li><a class="" href="../rest_api/api/v1.PodTemplate.html">v1.PodTemplate</a></li>
                  <li><a class="" href="../rest_api/api/v1.ReplicationController.html">v1.ReplicationController</a></li>
                  <li><a class="" href="../rest_api/api/v1.ResourceQuota.html">v1.ResourceQuota</a></li>
                  <li><a class="" href="../rest_api/api/v1.Secret.html">v1.Secret</a></li>
                  <li><a class="" href="../rest_api/api/v1.SecurityContextConstraints.html">v1.SecurityContextConstraints</a></li>
                  <li><a class="" href="../rest_api/api/v1.Service.html">v1.Service</a></li>
                  <li><a class="" href="../rest_api/api/v1.ServiceAccount.html">v1.ServiceAccount</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-3">
                <span id="sgSpan-15-3" class="fa fa-caret-right"></span>&nbsp;/apis/v1
              </a>
              <ul id="topicSubGroup-15-3" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis/v1.APIGroup.html">v1.APIGroup</a></li>
                  <li><a class="" href="../rest_api/apis/v1.APIGroupList.html">v1.APIGroupList</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-4">
                <span id="sgSpan-15-4" class="fa fa-caret-right"></span>&nbsp;/apis/apps/v1
              </a>
              <ul id="topicSubGroup-15-4" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-apps/v1.ControllerRevision.html">v1.ControllerRevision</a></li>
                  <li><a class="" href="../rest_api/apis-apps/v1.DaemonSet.html">v1.DaemonSet</a></li>
                  <li><a class="" href="../rest_api/apis-apps/v1.Deployment.html">v1.Deployment</a></li>
                  <li><a class="" href="../rest_api/apis-apps/v1.ReplicaSet.html">v1.ReplicaSet</a></li>
                  <li><a class="" href="../rest_api/apis-apps/v1.StatefulSet.html">v1.StatefulSet</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-5">
                <span id="sgSpan-15-5" class="fa fa-caret-right"></span>&nbsp;/apis/apps/v1beta1
              </a>
              <ul id="topicSubGroup-15-5" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-apps/v1beta1.ControllerRevision.html">v1beta1.ControllerRevision</a></li>
                  <li><a class="" href="../rest_api/apis-apps/v1beta1.Deployment.html">v1beta1.Deployment</a></li>
                  <li><a class="" href="../rest_api/apis-apps/v1beta1.StatefulSet.html">v1beta1.StatefulSet</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-6">
                <span id="sgSpan-15-6" class="fa fa-caret-right"></span>&nbsp;/apis/apps/v1beta2
              </a>
              <ul id="topicSubGroup-15-6" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-apps/v1beta2.ControllerRevision.html">v1beta2.ControllerRevision</a></li>
                  <li><a class="" href="../rest_api/apis-apps/v1beta2.DaemonSet.html">v1beta2.DaemonSet</a></li>
                  <li><a class="" href="../rest_api/apis-apps/v1beta2.Deployment.html">v1beta2.Deployment</a></li>
                  <li><a class="" href="../rest_api/apis-apps/v1beta2.ReplicaSet.html">v1beta2.ReplicaSet</a></li>
                  <li><a class="" href="../rest_api/apis-apps/v1beta2.StatefulSet.html">v1beta2.StatefulSet</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-7">
                <span id="sgSpan-15-7" class="fa fa-caret-right"></span>&nbsp;/apis/autoscaling/v1
              </a>
              <ul id="topicSubGroup-15-7" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-autoscaling/v1.HorizontalPodAutoscaler.html">v1.HorizontalPodAutoscaler</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-8">
                <span id="sgSpan-15-8" class="fa fa-caret-right"></span>&nbsp;/apis/autoscaling/v2beta1
              </a>
              <ul id="topicSubGroup-15-8" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-autoscaling/v2beta1.HorizontalPodAutoscaler.html">v2beta1.HorizontalPodAutoscaler</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-9">
                <span id="sgSpan-15-9" class="fa fa-caret-right"></span>&nbsp;/apis/batch/v1
              </a>
              <ul id="topicSubGroup-15-9" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-batch/v1.Job.html">v1.Job</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-10">
                <span id="sgSpan-15-10" class="fa fa-caret-right"></span>&nbsp;/apis/batch/v1beta1
              </a>
              <ul id="topicSubGroup-15-10" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-batch/v1beta1.CronJob.html">v1beta1.CronJob</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-11">
                <span id="sgSpan-15-11" class="fa fa-caret-right"></span>&nbsp;/apis/batch/v2alpha1
              </a>
              <ul id="topicSubGroup-15-11" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-batch/v2alpha1.CronJob.html">v2alpha1.CronJob</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-12">
                <span id="sgSpan-15-12" class="fa fa-caret-right"></span>&nbsp;/apis/extensions/v1beta1
              </a>
              <ul id="topicSubGroup-15-12" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-extensions/v1beta1.DaemonSet.html">v1beta1.DaemonSet</a></li>
                  <li><a class="" href="../rest_api/apis-extensions/v1beta1.Deployment.html">v1beta1.Deployment</a></li>
                  <li><a class="" href="../rest_api/apis-extensions/v1beta1.Ingress.html">v1beta1.Ingress</a></li>
                  <li><a class="" href="../rest_api/apis-extensions/v1beta1.NetworkPolicy.html">v1beta1.NetworkPolicy</a></li>
                  <li><a class="" href="../rest_api/apis-extensions/v1beta1.PodSecurityPolicy.html">v1beta1.PodSecurityPolicy</a></li>
                  <li><a class="" href="../rest_api/apis-extensions/v1beta1.ReplicaSet.html">v1beta1.ReplicaSet</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-13">
                <span id="sgSpan-15-13" class="fa fa-caret-right"></span>&nbsp;/apis/policy/v1beta1
              </a>
              <ul id="topicSubGroup-15-13" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-policy/v1beta1.PodDisruptionBudget.html">v1beta1.PodDisruptionBudget</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-14">
                <span id="sgSpan-15-14" class="fa fa-caret-right"></span>&nbsp;/apis/admissionregistration.k8s.io/v1beta1
              </a>
              <ul id="topicSubGroup-15-14" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-admissionregistration.k8s.io/v1beta1.MutatingWebhookConfiguration.html">v1beta1.MutatingWebhookConfiguration</a></li>
                  <li><a class="" href="../rest_api/apis-admissionregistration.k8s.io/v1beta1.ValidatingWebhookConfiguration.html">v1beta1.ValidatingWebhookConfiguration</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-15">
                <span id="sgSpan-15-15" class="fa fa-caret-right"></span>&nbsp;/apis/apiregistration.k8s.io/v1beta1
              </a>
              <ul id="topicSubGroup-15-15" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-apiregistration.k8s.io/v1beta1.APIService.html">v1beta1.APIService</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-16">
                <span id="sgSpan-15-16" class="fa fa-caret-right"></span>&nbsp;/apis/authentication.k8s.io/v1
              </a>
              <ul id="topicSubGroup-15-16" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-authentication.k8s.io/v1.TokenReview.html">v1.TokenReview</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-17">
                <span id="sgSpan-15-17" class="fa fa-caret-right"></span>&nbsp;/apis/authentication.k8s.io/v1beta1
              </a>
              <ul id="topicSubGroup-15-17" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-authentication.k8s.io/v1beta1.TokenReview.html">v1beta1.TokenReview</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-18">
                <span id="sgSpan-15-18" class="fa fa-caret-right"></span>&nbsp;/apis/authorization.k8s.io/v1
              </a>
              <ul id="topicSubGroup-15-18" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-authorization.k8s.io/v1.LocalSubjectAccessReview.html">v1.LocalSubjectAccessReview</a></li>
                  <li><a class="" href="../rest_api/apis-authorization.k8s.io/v1.SelfSubjectAccessReview.html">v1.SelfSubjectAccessReview</a></li>
                  <li><a class="" href="../rest_api/apis-authorization.k8s.io/v1.SelfSubjectRulesReview.html">v1.SelfSubjectRulesReview</a></li>
                  <li><a class="" href="../rest_api/apis-authorization.k8s.io/v1.SubjectAccessReview.html">v1.SubjectAccessReview</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-19">
                <span id="sgSpan-15-19" class="fa fa-caret-right"></span>&nbsp;/apis/authorization.k8s.io/v1beta1
              </a>
              <ul id="topicSubGroup-15-19" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-authorization.k8s.io/v1beta1.LocalSubjectAccessReview.html">v1beta1.LocalSubjectAccessReview</a></li>
                  <li><a class="" href="../rest_api/apis-authorization.k8s.io/v1beta1.SelfSubjectAccessReview.html">v1beta1.SelfSubjectAccessReview</a></li>
                  <li><a class="" href="../rest_api/apis-authorization.k8s.io/v1beta1.SelfSubjectRulesReview.html">v1beta1.SelfSubjectRulesReview</a></li>
                  <li><a class="" href="../rest_api/apis-authorization.k8s.io/v1beta1.SubjectAccessReview.html">v1beta1.SubjectAccessReview</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-20">
                <span id="sgSpan-15-20" class="fa fa-caret-right"></span>&nbsp;/apis/rbac.authorization.k8s.io/v1
              </a>
              <ul id="topicSubGroup-15-20" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-rbac.authorization.k8s.io/v1.ClusterRole.html">v1.ClusterRole</a></li>
                  <li><a class="" href="../rest_api/apis-rbac.authorization.k8s.io/v1.ClusterRoleBinding.html">v1.ClusterRoleBinding</a></li>
                  <li><a class="" href="../rest_api/apis-rbac.authorization.k8s.io/v1.Role.html">v1.Role</a></li>
                  <li><a class="" href="../rest_api/apis-rbac.authorization.k8s.io/v1.RoleBinding.html">v1.RoleBinding</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-21">
                <span id="sgSpan-15-21" class="fa fa-caret-right"></span>&nbsp;/apis/rbac.authorization.k8s.io/v1beta1
              </a>
              <ul id="topicSubGroup-15-21" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-rbac.authorization.k8s.io/v1beta1.ClusterRole.html">v1beta1.ClusterRole</a></li>
                  <li><a class="" href="../rest_api/apis-rbac.authorization.k8s.io/v1beta1.ClusterRoleBinding.html">v1beta1.ClusterRoleBinding</a></li>
                  <li><a class="" href="../rest_api/apis-rbac.authorization.k8s.io/v1beta1.Role.html">v1beta1.Role</a></li>
                  <li><a class="" href="../rest_api/apis-rbac.authorization.k8s.io/v1beta1.RoleBinding.html">v1beta1.RoleBinding</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-22">
                <span id="sgSpan-15-22" class="fa fa-caret-right"></span>&nbsp;/apis/certificates.k8s.io/v1beta1
              </a>
              <ul id="topicSubGroup-15-22" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-certificates.k8s.io/v1beta1.CertificateSigningRequest.html">v1beta1.CertificateSigningRequest</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-23">
                <span id="sgSpan-15-23" class="fa fa-caret-right"></span>&nbsp;/apis/events.k8s.io/v1beta1
              </a>
              <ul id="topicSubGroup-15-23" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-events.k8s.io/v1beta1.Event.html">v1beta1.Event</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-24">
                <span id="sgSpan-15-24" class="fa fa-caret-right"></span>&nbsp;/apis/networking.k8s.io/v1
              </a>
              <ul id="topicSubGroup-15-24" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-networking.k8s.io/v1.NetworkPolicy.html">v1.NetworkPolicy</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-25">
                <span id="sgSpan-15-25" class="fa fa-caret-right"></span>&nbsp;/apis/storage.k8s.io/v1
              </a>
              <ul id="topicSubGroup-15-25" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-storage.k8s.io/v1.StorageClass.html">v1.StorageClass</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-26">
                <span id="sgSpan-15-26" class="fa fa-caret-right"></span>&nbsp;/apis/storage.k8s.io/v1beta1
              </a>
              <ul id="topicSubGroup-15-26" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-storage.k8s.io/v1beta1.StorageClass.html">v1beta1.StorageClass</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-27">
                <span id="sgSpan-15-27" class="fa fa-caret-right"></span>&nbsp;/apis/apps.openshift.io/v1
              </a>
              <ul id="topicSubGroup-15-27" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-apps.openshift.io/v1.DeploymentConfig.html">v1.DeploymentConfig</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-28">
                <span id="sgSpan-15-28" class="fa fa-caret-right"></span>&nbsp;/apis/authorization.openshift.io/v1
              </a>
              <ul id="topicSubGroup-15-28" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-authorization.openshift.io/v1.ClusterRole.html">v1.ClusterRole</a></li>
                  <li><a class="" href="../rest_api/apis-authorization.openshift.io/v1.ClusterRoleBinding.html">v1.ClusterRoleBinding</a></li>
                  <li><a class="" href="../rest_api/apis-authorization.openshift.io/v1.LocalResourceAccessReview.html">v1.LocalResourceAccessReview</a></li>
                  <li><a class="" href="../rest_api/apis-authorization.openshift.io/v1.LocalSubjectAccessReview.html">v1.LocalSubjectAccessReview</a></li>
                  <li><a class="" href="../rest_api/apis-authorization.openshift.io/v1.ResourceAccessReview.html">v1.ResourceAccessReview</a></li>
                  <li><a class="" href="../rest_api/apis-authorization.openshift.io/v1.Role.html">v1.Role</a></li>
                  <li><a class="" href="../rest_api/apis-authorization.openshift.io/v1.RoleBinding.html">v1.RoleBinding</a></li>
                  <li><a class="" href="../rest_api/apis-authorization.openshift.io/v1.RoleBindingRestriction.html">v1.RoleBindingRestriction</a></li>
                  <li><a class="" href="../rest_api/apis-authorization.openshift.io/v1.SelfSubjectRulesReview.html">v1.SelfSubjectRulesReview</a></li>
                  <li><a class="" href="../rest_api/apis-authorization.openshift.io/v1.SubjectAccessReview.html">v1.SubjectAccessReview</a></li>
                  <li><a class="" href="../rest_api/apis-authorization.openshift.io/v1.SubjectRulesReview.html">v1.SubjectRulesReview</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-29">
                <span id="sgSpan-15-29" class="fa fa-caret-right"></span>&nbsp;/apis/build.openshift.io/v1
              </a>
              <ul id="topicSubGroup-15-29" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-build.openshift.io/v1.Build.html">v1.Build</a></li>
                  <li><a class="" href="../rest_api/apis-build.openshift.io/v1.BuildConfig.html">v1.BuildConfig</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-30">
                <span id="sgSpan-15-30" class="fa fa-caret-right"></span>&nbsp;/apis/image.openshift.io/v1
              </a>
              <ul id="topicSubGroup-15-30" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-image.openshift.io/v1.Image.html">v1.Image</a></li>
                  <li><a class="" href="../rest_api/apis-image.openshift.io/v1.ImageSignature.html">v1.ImageSignature</a></li>
                  <li><a class="" href="../rest_api/apis-image.openshift.io/v1.ImageStream.html">v1.ImageStream</a></li>
                  <li><a class="" href="../rest_api/apis-image.openshift.io/v1.ImageStreamImage.html">v1.ImageStreamImage</a></li>
                  <li><a class="" href="../rest_api/apis-image.openshift.io/v1.ImageStreamImport.html">v1.ImageStreamImport</a></li>
                  <li><a class="" href="../rest_api/apis-image.openshift.io/v1.ImageStreamMapping.html">v1.ImageStreamMapping</a></li>
                  <li><a class="" href="../rest_api/apis-image.openshift.io/v1.ImageStreamTag.html">v1.ImageStreamTag</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-31">
                <span id="sgSpan-15-31" class="fa fa-caret-right"></span>&nbsp;/apis/network.openshift.io/v1
              </a>
              <ul id="topicSubGroup-15-31" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-network.openshift.io/v1.ClusterNetwork.html">v1.ClusterNetwork</a></li>
                  <li><a class="" href="../rest_api/apis-network.openshift.io/v1.EgressNetworkPolicy.html">v1.EgressNetworkPolicy</a></li>
                  <li><a class="" href="../rest_api/apis-network.openshift.io/v1.HostSubnet.html">v1.HostSubnet</a></li>
                  <li><a class="" href="../rest_api/apis-network.openshift.io/v1.NetNamespace.html">v1.NetNamespace</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-32">
                <span id="sgSpan-15-32" class="fa fa-caret-right"></span>&nbsp;/apis/oauth.openshift.io/v1
              </a>
              <ul id="topicSubGroup-15-32" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-oauth.openshift.io/v1.OAuthAccessToken.html">v1.OAuthAccessToken</a></li>
                  <li><a class="" href="../rest_api/apis-oauth.openshift.io/v1.OAuthAuthorizeToken.html">v1.OAuthAuthorizeToken</a></li>
                  <li><a class="" href="../rest_api/apis-oauth.openshift.io/v1.OAuthClient.html">v1.OAuthClient</a></li>
                  <li><a class="" href="../rest_api/apis-oauth.openshift.io/v1.OAuthClientAuthorization.html">v1.OAuthClientAuthorization</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-33">
                <span id="sgSpan-15-33" class="fa fa-caret-right"></span>&nbsp;/apis/project.openshift.io/v1
              </a>
              <ul id="topicSubGroup-15-33" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-project.openshift.io/v1.Project.html">v1.Project</a></li>
                  <li><a class="" href="../rest_api/apis-project.openshift.io/v1.ProjectRequest.html">v1.ProjectRequest</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-34">
                <span id="sgSpan-15-34" class="fa fa-caret-right"></span>&nbsp;/apis/quota.openshift.io/v1
              </a>
              <ul id="topicSubGroup-15-34" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-quota.openshift.io/v1.AppliedClusterResourceQuota.html">v1.AppliedClusterResourceQuota</a></li>
                  <li><a class="" href="../rest_api/apis-quota.openshift.io/v1.ClusterResourceQuota.html">v1.ClusterResourceQuota</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-35">
                <span id="sgSpan-15-35" class="fa fa-caret-right"></span>&nbsp;/apis/route.openshift.io/v1
              </a>
              <ul id="topicSubGroup-15-35" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-route.openshift.io/v1.Route.html">v1.Route</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-36">
                <span id="sgSpan-15-36" class="fa fa-caret-right"></span>&nbsp;/apis/security.openshift.io/v1
              </a>
              <ul id="topicSubGroup-15-36" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-security.openshift.io/v1.PodSecurityPolicyReview.html">v1.PodSecurityPolicyReview</a></li>
                  <li><a class="" href="../rest_api/apis-security.openshift.io/v1.PodSecurityPolicySelfSubjectReview.html">v1.PodSecurityPolicySelfSubjectReview</a></li>
                  <li><a class="" href="../rest_api/apis-security.openshift.io/v1.PodSecurityPolicySubjectReview.html">v1.PodSecurityPolicySubjectReview</a></li>
                  <li><a class="" href="../rest_api/apis-security.openshift.io/v1.SecurityContextConstraints.html">v1.SecurityContextConstraints</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-37">
                <span id="sgSpan-15-37" class="fa fa-caret-right"></span>&nbsp;/apis/template.openshift.io/v1
              </a>
              <ul id="topicSubGroup-15-37" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-template.openshift.io/v1.BrokerTemplateInstance.html">v1.BrokerTemplateInstance</a></li>
                  <li><a class="" href="../rest_api/apis-template.openshift.io/v1.Template.html">v1.Template</a></li>
                  <li><a class="" href="../rest_api/apis-template.openshift.io/v1.TemplateInstance.html">v1.TemplateInstance</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-38">
                <span id="sgSpan-15-38" class="fa fa-caret-right"></span>&nbsp;/apis/user.openshift.io/v1
              </a>
              <ul id="topicSubGroup-15-38" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/apis-user.openshift.io/v1.Group.html">v1.Group</a></li>
                  <li><a class="" href="../rest_api/apis-user.openshift.io/v1.Identity.html">v1.Identity</a></li>
                  <li><a class="" href="../rest_api/apis-user.openshift.io/v1.User.html">v1.User</a></li>
                  <li><a class="" href="../rest_api/apis-user.openshift.io/v1.UserIdentityMapping.html">v1.UserIdentityMapping</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-15-39">
                <span id="sgSpan-15-39" class="fa fa-caret-right"></span>&nbsp;/oapi/v1
              </a>
              <ul id="topicSubGroup-15-39" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../rest_api/oapi/v1.AppliedClusterResourceQuota.html">v1.AppliedClusterResourceQuota</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.Build.html">v1.Build</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.BuildConfig.html">v1.BuildConfig</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.ClusterNetwork.html">v1.ClusterNetwork</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.ClusterResourceQuota.html">v1.ClusterResourceQuota</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.ClusterRole.html">v1.ClusterRole</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.ClusterRoleBinding.html">v1.ClusterRoleBinding</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.DeploymentConfig.html">v1.DeploymentConfig</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.EgressNetworkPolicy.html">v1.EgressNetworkPolicy</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.Group.html">v1.Group</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.HostSubnet.html">v1.HostSubnet</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.Identity.html">v1.Identity</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.Image.html">v1.Image</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.ImageSignature.html">v1.ImageSignature</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.ImageStream.html">v1.ImageStream</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.ImageStreamImage.html">v1.ImageStreamImage</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.ImageStreamImport.html">v1.ImageStreamImport</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.ImageStreamMapping.html">v1.ImageStreamMapping</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.ImageStreamTag.html">v1.ImageStreamTag</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.LocalResourceAccessReview.html">v1.LocalResourceAccessReview</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.LocalSubjectAccessReview.html">v1.LocalSubjectAccessReview</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.NetNamespace.html">v1.NetNamespace</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.OAuthAccessToken.html">v1.OAuthAccessToken</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.OAuthAuthorizeToken.html">v1.OAuthAuthorizeToken</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.OAuthClient.html">v1.OAuthClient</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.OAuthClientAuthorization.html">v1.OAuthClientAuthorization</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.PodSecurityPolicyReview.html">v1.PodSecurityPolicyReview</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.PodSecurityPolicySelfSubjectReview.html">v1.PodSecurityPolicySelfSubjectReview</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.PodSecurityPolicySubjectReview.html">v1.PodSecurityPolicySubjectReview</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.ProcessedTemplate.html">v1.ProcessedTemplate</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.Project.html">v1.Project</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.ProjectRequest.html">v1.ProjectRequest</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.ResourceAccessReview.html">v1.ResourceAccessReview</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.Role.html">v1.Role</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.RoleBinding.html">v1.RoleBinding</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.RoleBindingRestriction.html">v1.RoleBindingRestriction</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.Route.html">v1.Route</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.SelfSubjectRulesReview.html">v1.SelfSubjectRulesReview</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.SubjectAccessReview.html">v1.SubjectAccessReview</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.SubjectRulesReview.html">v1.SubjectRulesReview</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.Template.html">v1.Template</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.User.html">v1.User</a></li>
                  <li><a class="" href="../rest_api/oapi/v1.UserIdentityMapping.html">v1.UserIdentityMapping</a></li>
              </ul>
            </li>
      </ul>
    </li>
</ul>
      </div>
      <div class="col-xs-12 col-sm-9 col-md-9 main">
        <div class="page-header">
          <h1>Host-level tasks</h1>
        </div>
        <div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title"></div>
<ul class="sectlevel1">
<li><a href="#adding-a-host-to-the-cluster">Adding a host to the cluster</a></li>
<li><a href="#master-host-tasks">Master host tasks</a>
<ul class="sectlevel2">
<li><a href="#day-two-guide-deprecating-master">Deprecating a master host</a></li>
<li><a href="#day-two-guide-master-backup">Creating a master host backup</a></li>
<li><a href="#day-two-guide-restore-master">Restoring a master host backup</a></li>
</ul>
</li>
<li><a href="#node-host-tasks">Node host tasks</a>
<ul class="sectlevel2">
<li><a href="#day-two-guide-deprecating-node">Deprecating a node host</a></li>
<li><a href="#day-two-guide-node-backup">Creating a node host backup</a></li>
<li><a href="#day-two-guide-restore-node">Restoring a node host backup</a></li>
<li><a href="#day-two-guide-node-maintenance">Node maintenance</a></li>
</ul>
</li>
<li><a href="#day-two-guide-etcd-backup">etcd tasks</a>
<ul class="sectlevel2">
<li><a href="#back-up-and-restore-etcd">Back up and restore etcd</a></li>
<li><a href="#scaling-etcd">Scaling etcd</a></li>
<li><a href="#removing-an-etcd-host">Removing an etcd host</a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="adding-a-host-to-the-cluster"><a class="anchor" href="#adding-a-host-to-the-cluster"></a>Adding a host to the cluster</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For information on adding master or node hosts to a cluster, see the
<a href="../install_config/adding_hosts_to_existing_cluster.html#install-config-adding-hosts-to-cluster">Adding
hosts to an existing cluster</a> section in the Install and configuration guide.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-host-tasks"><a class="anchor" href="#master-host-tasks"></a>Master host tasks</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="day-two-guide-deprecating-master"><a class="anchor" href="#day-two-guide-deprecating-master"></a>Deprecating a master host</h3>
<div class="paragraph">
<p>Deprecating a master host removes it from the OpenShift Origin environment.</p>
</div>
<div class="paragraph">
<p>The reasons to deprecate or scale down master hosts include hardware re-sizing
or replacing the underlying infrastructure.</p>
</div>
<div class="paragraph">
<p>Highly available OpenShift Origin environments require at least three master
hosts and three etcd nodes. Usually, the master hosts are collocated with the
etcd services. This topic describes the deprecation process for master hosts
with or without collocated etcd.</p>
</div>
<div class="paragraph">
<p>You should create a backup of the configuration and data files prior to any
important task such as deprecating a master host. See the
<a href="../day_two_guide/host_level_tasks.html#day-two-guide-master-backup">Creating
a master host backup</a> and
<a href="../day_two_guide/host_level_tasks.html#day-two-guide-etcd-backup">etcd
tasks</a> sections for more information.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ensure that the master and etcd services are always deployed in odd numbers due
to the voting mechanisms that take place among those services.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="day-two-guide-host-tasks-deprecating-master-without-etcd"><a class="anchor" href="#day-two-guide-host-tasks-deprecating-master-without-etcd"></a>Deprecating a master host without collocated etcd</h4>
<div class="paragraph">
<p>Master hosts run important services, such as the OpenShift Origin API and
controllers services (if multiple masters are present). In order to deprecate a
master host, these services must be stopped.</p>
</div>
<div class="paragraph">
<p>The OpenShift Origin API service is an active/active service, so stopping the
service does not affect the environment as long as the requests are sent to a
separate master server. However, the OpenShift Origin controllers service is an
active/passive service, where the services leverage etcd to decide the active
master.</p>
</div>
<div class="paragraph">
<p>Deprecating a master host in a multi-master architecture includes removing the
master from the load balancer pool to avoid new connections attempting to use
that master. This process depends heavily on the load balancer used. The steps
below show the details of removing the master from <code>haproxy</code>. In the event that
OpenShift Origin is running on a cloud provider, or using a <code>F5</code> appliance, see
the specific product documents to remove the master from rotation.</p>
</div>
<h2 id="procedure" class="discrete">Procedure</h2>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Remove the <code>backend</code> section in the <code>/etc/haproxy/haproxy.cfg</code> configuration
file. For example, if deprecating a master named <code>master-0.example.com</code> using
<code>haproxy</code>, ensure the host name is removed from the following:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">backend mgmt8443
    balance source
    mode tcp
    # MASTERS 8443
    server master-1.example.com 192.168.55.12:8443 check
    server master-2.example.com 192.168.55.13:8443 check</pre>
</div>
</div>
</li>
<li>
<p>Then, restart the <code>haproxy</code> service.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ sudo systemctl restart haproxy</pre>
</div>
</div>
</li>
<li>
<p>Once the master is removed from the load balancer, disable the API and
controller services:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ sudo systemctl disable --now atomic-openshift-master-api
$ sudo systemctl disable --now atomic-openshift-master-controllers</pre>
</div>
</div>
</li>
<li>
<p>Because the master host is a unschedulable OpenShift Origin node, follow the
steps in the
<a href="../day_two_guide/host_level_tasks.html#day-two-guide-deprecating-node">Deprecating
a node host</a> section.</p>
</li>
<li>
<p>Remove the master host from the <code>[masters]</code> and <code>[nodes]</code> groups in the
<code>/etc/ansible/hosts</code> Ansible inventory file to avoid issues if running any
Ansible tasks using that inventory file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">...[OUTPUT OMITTED]...
# host group for masters
[masters]
*master-0.example.com*
master-1.example.com
master-2.example.com

# host group for nodes, includes region info
[nodes]
*master-0.example.com openshift_node_labels="{'role': 'master'}" openshift_hostname=master-0.example.com openshift_schedulable=false*
...[OUTPUT OMITTED]...</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Deprecating the first master host listed in the Ansible inventory file requires
extra precautions.</p>
</div>
<div class="paragraph">
<p>At the time of writing, the <code>/etc/origin/master/ca.serial.txt</code> file is
generated onto only the first master listed in the Ansible host inventory.
This is being investigated to be fixed in future OpenShift Origin releases in the
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=1469358">1469358 bugzilla</a>. If
deprecating the first master host, copy the <code>/etc/origin/master/ca.serial.txt</code>
file to the rest of master hosts before the process.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>The <code>kubernetes</code> service includes the master host IPs as endpoints. To
verify that the master has been properly deprecated, review the <code>kubernetes</code>
service output and see if the deprecated master has been removed:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc describe svc kubernetes -n default
Name:			kubernetes
Namespace:		default
Labels:			component=apiserver
			provider=kubernetes
Annotations:		&lt;none&gt;
Selector:		&lt;none&gt;
Type:			ClusterIP
IP:			10.111.0.1
Port:			https	443/TCP
Endpoints:		192.168.55.12:8443,192.168.55.13:8443
Port:			dns	53/UDP
Endpoints:		192.168.55.12:8053,192.168.55.13:8053
Port:			dns-tcp	53/TCP
Endpoints:		192.168.55.12:8053,192.168.55.13:8053
Session Affinity:	ClientIP
Events:			&lt;none&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Once the master has been successfully deprecated, the host where the master
was previously running can be safely deleted.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="deprecating-a-collocated-etcd-master-host"><a class="anchor" href="#deprecating-a-collocated-etcd-master-host"></a>Deprecating master host with collocated etcd</h4>
<div class="paragraph">
<p>To deprecate a master host running an etcd service, execute the previous steps
in
<a href="../day_two_guide/host_level_tasks.html#day-two-guide-host-tasks-deprecating-master-without-etcd">Deprecating
a master host without collocated etcd</a>, as well as the steps in
<a href="../day_two_guide/host_level_tasks.html#removing-an-etcd-host">Removing an
etcd host</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="day-two-guide-replacing-master"><a class="anchor" href="#day-two-guide-replacing-master"></a>Replacing a master host</h4>
<div class="paragraph">
<p>In the event of replacing a broken master host, follow the process in
<a href="../day_two_guide/host_level_tasks.html#day-two_guide_host-tasks-deprecating-master-without-etcd">Deprecating
a master host without collocated etcd</a>, then scale up the master hosts using the scale up Ansible playbook following the steps in
<a href="../install_config/adding_hosts_to_existing_cluster.html#install-config-adding-hosts-to-cluster">Adding hosts to an
existing cluster</a>.</p>
</div>
<div class="paragraph">
<p>If the master host has a collocated etcd, use the
<a href="../day_two_guide/host_level_tasks.html#deprecating-a-collocated-etcd-master_host">Deprecating
master host with collocated etcd</a> steps, then the
<a href="../install_config/adding_hosts_to_existing_cluster.html#install-config-adding-hosts-to-cluster">Adding hosts to an
existing cluster</a> as well as
<a href="../day_two_guide/host_level_tasks.html#scaling-etcd">Scaling etcd</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="day-two-guide-master-backup"><a class="anchor" href="#day-two-guide-master-backup"></a>Creating a master host backup</h3>
<div class="paragraph">
<p>The backup process is to be performed before any change to the infrastructure,
such as a system update, upgrade, or any other significant modification. Backups
should be performed on a regular basis to ensure the most recent data is
available if a failure occurs.</p>
</div>
<div class="paragraph">
<p><strong>OpenShift Origin files</strong></p>
</div>
<div class="paragraph">
<p>The master instances run important services, such as the API, controllers. The <code>/etc/origin/master</code> directory stores many important files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The configuration the API, controllers, services, and more</p>
</li>
<li>
<p>Certificates generated by the installation</p>
</li>
<li>
<p>All cloud provider-related configuration</p>
</li>
<li>
<p>Keys and other authentication files, such as <code>htpasswd</code> if using htpasswd</p>
</li>
<li>
<p>And more</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The OpenShift Origin services can be customized to increase the log level, use
proxies, and so on. The configuration files are stored in the <code>/etc/sysconfig</code>
directory.</p>
</div>
<div class="paragraph">
<p>Because the masters are also unschedulable nodes, back up the entire
<code>/etc/origin</code> directory.</p>
</div>
<h2 id="procedure-2" class="discrete">Procedure</h2>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a backup of the master host configuration files:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ MYBACKUPDIR=/backup/$(hostname)/$(date +%Y%m%d)
$ sudo mkdir -p ${MYBACKUPDIR}/etc/sysconfig
$ sudo cp -aR /etc/origin ${MYBACKUPDIR}/etc
$ sudo cp -aR /etc/sysconfig/atomic-* ${MYBACKUPDIR}/etc/sysconfig/</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>On a single master cluster installation the configuration file is stored in the
<code>/etc/sysconfig/atomic-openshift-master</code>, whereas in a multi-master environment
<code>/etc/sysconfig/atomic-openshift-master-api</code>, and
<code>/etc/sysconfig/atomic-openshift-master-controllers</code> are used.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>At the time of writing, the <code>/etc/origin/master/ca.serial.txt</code> file is generated
onto only the first master listed in the Ansible host inventory. This is being
investigated to be fixed for future OpenShift Origin releases in the
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=1469358">1469358 bugzilla</a>. If
deprecating the first master host, copy the <code>/etc/origin/master/ca.serial.txt</code>
file to the rest of master hosts before the process.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Other important files that need to be considered  when planning a backup
include:</p>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">File</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/etc/cni/*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container Network Interface configuration (if used)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/etc/sysconfig/iptables</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where the <code>iptables</code> rules are stored</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/etc/sysconfig/docker-storage-setup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The input file for <code>container-storage-setup</code> command</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/etc/sysconfig/docker</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>docker</code> configuration file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/etc/sysconfig/docker-network</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker</code> networking configuration (i.e. MTU)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/etc/sysconfig/docker-storage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker</code> storage configuration (generated by <code>container-storage-setup</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/etc/dnsmasq.conf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Main configuration file for <code>dnsmasq</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/etc/dnsmasq.d/*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Different <code>dnsmasq</code> configuration files</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/etc/sysconfig/flanneld</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>flannel</code> configuration file (if used)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/etc/pki/ca-trust/source/anchors/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Certificates added to the system (i.e. for external registries)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Create a backup of those files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ MYBACKUPDIR=/backup/$(hostname)/$(date +%Y%m%d)
$ sudo mkdir -p ${MYBACKUPDIR}/etc/sysconfig
$ sudo mkdir -p ${MYBACKUPDIR}/etc/pki/ca-trust/source/anchors
$ sudo cp -aR /etc/sysconfig/{iptables,docker-*,flanneld} \
    ${MYBACKUPDIR}/etc/sysconfig/
$ sudo cp -aR /etc/dnsmasq* /etc/cni ${MYBACKUPDIR}/etc/
$ sudo cp -aR /etc/pki/ca-trust/source/anchors/* \
    ${MYBACKUPDIR}/etc/pki/ca-trust/source/anchors/</pre>
</div>
</div>
</li>
<li>
<p>If a package is accidentally removed, or a file included in an <code>rpm</code>
package should be restored, having a list of <code>rhel</code> packages installed on the
system can be useful.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If using Red Hat Satellite features, such as content views or the facts store,
provide a proper mechanism to reinstall the missing packages and a historical
data of packages installed in the systems.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To create a list of the current <code>rhel</code> packages installed in the system:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ MYBACKUPDIR=/backup/$(hostname)/$(date +%Y%m%d)
$ sudo mkdir -p ${MYBACKUPDIR}
$ rpm -qa | sort | sudo tee $MYBACKUPDIR/packages.txt</pre>
</div>
</div>
</li>
<li>
<p>If using the previous steps, the following files should now be present in the
backup directory:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ MYBACKUPDIR=/backup/$(hostname)/$(date +%Y%m%d)
$ sudo find ${MYBACKUPDIR} -mindepth 1 -type f -printf '%P\n'
etc/sysconfig/atomic-openshift-master
etc/sysconfig/atomic-openshift-master-api
etc/sysconfig/atomic-openshift-master-controllers
etc/sysconfig/atomic-openshift-node
etc/sysconfig/flanneld
etc/sysconfig/iptables
etc/sysconfig/docker-network
etc/sysconfig/docker-storage
etc/sysconfig/docker-storage-setup
etc/sysconfig/docker-storage-setup.rpmnew
etc/origin/master/ca.crt
etc/origin/master/ca.key
etc/origin/master/ca.serial.txt
etc/origin/master/ca-bundle.crt
etc/origin/master/master.proxy-client.crt
etc/origin/master/master.proxy-client.key
etc/origin/master/service-signer.crt
etc/origin/master/service-signer.key
etc/origin/master/serviceaccounts.private.key
etc/origin/master/serviceaccounts.public.key
etc/origin/master/openshift-master.crt
etc/origin/master/openshift-master.key
etc/origin/master/openshift-master.kubeconfig
etc/origin/master/master.server.crt
etc/origin/master/master.server.key
etc/origin/master/master.kubelet-client.crt
etc/origin/master/master.kubelet-client.key
etc/origin/master/admin.crt
etc/origin/master/admin.key
etc/origin/master/admin.kubeconfig
etc/origin/master/etcd.server.crt
etc/origin/master/etcd.server.key
etc/origin/master/master.etcd-client.key
etc/origin/master/master.etcd-client.csr
etc/origin/master/master.etcd-client.crt
etc/origin/master/master.etcd-ca.crt
etc/origin/master/policy.json
etc/origin/master/scheduler.json
etc/origin/master/htpasswd
etc/origin/master/session-secrets.yaml
etc/origin/master/openshift-router.crt
etc/origin/master/openshift-router.key
etc/origin/master/registry.crt
etc/origin/master/registry.key
etc/origin/master/master-config.yaml
etc/origin/generated-configs/master-master-1.example.com/master.server.crt
...[OUTPUT OMITTED]...
etc/origin/cloudprovider/openstack.conf
etc/origin/node/system:node:master-0.example.com.crt
etc/origin/node/system:node:master-0.example.com.key
etc/origin/node/ca.crt
etc/origin/node/system:node:master-0.example.com.kubeconfig
etc/origin/node/server.crt
etc/origin/node/server.key
etc/origin/node/node-dnsmasq.conf
etc/origin/node/resolv.conf
etc/origin/node/node-config.yaml
etc/origin/node/flannel.etcd-client.key
etc/origin/node/flannel.etcd-client.csr
etc/origin/node/flannel.etcd-client.crt
etc/origin/node/flannel.etcd-ca.crt
etc/pki/ca-trust/source/anchors/openshift-ca.crt
etc/pki/ca-trust/source/anchors/registry-ca.crt
etc/dnsmasq.conf
etc/dnsmasq.d/origin-dns.conf
etc/dnsmasq.d/origin-upstream-dns.conf
etc/dnsmasq.d/node-dnsmasq.conf
packages.txt</pre>
</div>
</div>
<div class="paragraph">
<p>If needed, the files can be compressed to save space:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ MYBACKUPDIR=*/backup/$(hostname)/$(date +%Y%m%d)*
$ sudo tar -zcvf */backup/*$(hostname)-$(date +%Y%m%d).tar.gz $MYBACKUPDIR
$ sudo rm -Rf ${MYBACKUPDIR}</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>To create any of these files from scratch, the <code>openshift-ansible-contrib</code>
repository contains the <code>backup_master_node.sh</code> script, which performs the
previous steps. The script creates a directory on the host running the script
and copies all the files previously mentioned.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>openshift-ansible-contrib</code> script is not supported by Red Hat, but the
reference architecture team performs testing to ensure the code operates as
defined and is secure.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The script can be executed on every master host with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ mkdir ~/git
$ cd ~/git
$ git clone https://github.com/openshift/openshift-ansible-contrib.git
$ cd openshift-ansible-contrib/reference-architecture/day2ops/scripts
$ ./backup_master_node.sh -h</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="day-two-guide-restore-master"><a class="anchor" href="#day-two-guide-restore-master"></a>Restoring a master host backup</h3>
<div class="paragraph">
<p>After creating a backup of important master host files, if they become corrupted
or accidentally removed, you can restore the file by copying back the file,
ensuring it contains the proper content and restart the affected services.</p>
</div>
<h2 id="procedure-3" class="discrete">Procedure</h2>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Restore the <code>/etc/origin/master/master-config.yaml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># MYBACKUPDIR=*/backup/$(hostname)/$(date +%Y%m%d)*
# cp /etc/origin/master/master-config.yaml /etc/origin/master/master-config.yaml.old
# cp /backup/$(hostname)/$(date +%Y%m%d)/origin/master/master-config.yaml /etc/origin/master/master-config.yaml
# systemctl restart atomic-openshift-master-api
# systemctl restart atomic-openshift-master-controllers</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Restarting the master services can lead to downtime. However, you can remove the
master host from the highly available load balancer pool, then perform the
restore operation. Once the service has been properly restored, you can add the
master host back to the load balancer pool.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Perform a full reboot of the affected instance to restore the <code>iptables</code>
configuration.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>If the issue is an accidental package and its dependencies are removed,
reinstall the package.</p>
<div class="paragraph">
<p>Get the list of the current installed packages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ rpm -qa | sort &gt; /tmp/current_packages.txt</pre>
</div>
</div>
</li>
<li>
<p>Get the differences:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ diff /tmp/current_packages.txt ${MYBACKUPDIR}/packages.txt
1a2
&gt; ansible-2.4.0.0-5.el7.noarch</pre>
</div>
</div>
</li>
<li>
<p>Reinstall the missing packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum reinstall -y *ansible-2.4.0.0-5.el7.noarch*</pre>
</div>
</div>
</li>
<li>
<p>Restore a system certificate by copying the certificate to the
<code>/etc/pki/ca-trust/source/anchors/</code> directory and execute the <code>update-ca-trust</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ MYBACKUPDIR=*/backup/$(hostname)/$(date +%Y%m%d)*
$ sudo cp ${MYBACKUPDIR}/external_certificates/my_company.crt /etc/pki/ca-trust/source/anchors/
$ sudo update-ca-trust</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Always ensure the user ID and group ID are restored when the files are copied
back, as well as the <code>SELinux</code> context.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="node-host-tasks"><a class="anchor" href="#node-host-tasks"></a>Node host tasks</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="day-two-guide-deprecating-node"><a class="anchor" href="#day-two-guide-deprecating-node"></a>Deprecating a node host</h3>
<div class="paragraph">
<p>The procedure is the same whether deprecating an infrastructure node or an
application node.</p>
</div>
<h2 id="prerequisites" class="discrete">Prerequisites</h2>
<div class="paragraph">
<p>Ensure enough capacity is available to migrate the existing pods from the
node set to be removed. Removing an infrastructure node is advised only when at
least two more nodes will stay online after the infrastructure node is removed.</p>
</div>
<h2 id="procedure-4" class="discrete">Procedure</h2>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>List all available nodes to find the node to deprecate:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get nodes
NAME                  STATUS                     AGE       VERSION
ocp-infra-node-b7pl   Ready                      23h       v1.6.1+5115d708d7
ocp-infra-node-p5zj   Ready                      23h       v1.6.1+5115d708d7
ocp-infra-node-rghb   Ready                      23h       v1.6.1+5115d708d7
ocp-master-dgf8       Ready,SchedulingDisabled   23h       v1.6.1+5115d708d7
ocp-master-q1v2       Ready,SchedulingDisabled   23h       v1.6.1+5115d708d7
ocp-master-vq70       Ready,SchedulingDisabled   23h       v1.6.1+5115d708d7
ocp-node-020m         Ready                      23h       v1.6.1+5115d708d7
ocp-node-7t5p         Ready                      23h       v1.6.1+5115d708d7
ocp-node-n0dd         Ready                      23h       v1.6.1+5115d708d7</pre>
</div>
</div>
<div class="paragraph">
<p>As an example, this topic deprecates the <code>ocp-infra-node-b7pl</code> infrastructure
node.</p>
</div>
</li>
<li>
<p>Describe the node and its running services:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc describe node ocp-infra-node-b7pl
Name:			ocp-infra-node-b7pl
Role:
Labels:			beta.kubernetes.io/arch=amd64
			beta.kubernetes.io/instance-type=n1-standard-2
			beta.kubernetes.io/os=linux
			failure-domain.beta.kubernetes.io/region=europe-west3
			failure-domain.beta.kubernetes.io/zone=europe-west3-c
			kubernetes.io/hostname=ocp-infra-node-b7pl
			role=infra
Annotations:		volumes.kubernetes.io/controller-managed-attach-detach=true
Taints:			&lt;none&gt;
CreationTimestamp:	Wed, 22 Nov 2017 09:36:36 -0500
Phase:
Conditions:
  ...
Addresses:		10.156.0.11,ocp-infra-node-b7pl
Capacity:
 cpu:		2
 memory:	7494480Ki
 pods:		20
Allocatable:
 cpu:		2
 memory:	7392080Ki
 pods:		20
System Info:
 Machine ID:			bc95ccf67d047f2ae42c67862c202e44
 System UUID:			9762CC3D-E23C-AB13-B8C5-FA16F0BCCE4C
 Boot ID:			ca8bf088-905d-4ec0-beec-8f89f4527ce4
 Kernel Version:		3.10.0-693.5.2.el7.x86_64
 OS Image:			Employee SKU
 Operating System:		linux
 Architecture:			amd64
 Container Runtime Version:	docker://1.12.6
 Kubelet Version:		v1.6.1+5115d708d7
 Kube-Proxy Version:		v1.6.1+5115d708d7
ExternalID:			437740049672994824
Non-terminated Pods:		(2 in total)
  Namespace			Name				CPU Requests	CPU Limits	Memory Requests	Memory Limits
  ---------			----				------------	----------	---------------	-------------
  default			docker-registry-1-5szjs		100m (5%)	0 (0%)		256Mi (3%)0 (0%)
  default			router-1-vzlzq			100m (5%)	0 (0%)		256Mi (3%)0 (0%)
Allocated resources:
  (Total limits may be over 100 percent, i.e., overcommitted.)
  CPU Requests	CPU Limits	Memory Requests	Memory Limits
  ------------	----------	---------------	-------------
  200m (10%)	0 (0%)		512Mi (7%)	0 (0%)
Events:		&lt;none&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The output above shows that the node is running two pods: <code>router-1-vzlzq</code> and
<code>docker-registry-1-5szjs</code>. Two more infrastructure nodes are available to migrate these two pods.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The cluster described above is a highly available cluster, this means both the
<code>router</code> and <code>docker-registry</code> services are running on all infrastructure nodes.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Mark a node as unschedulable and evacuate all of its pods:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc adm drain ocp-infra-node-b7pl --delete-local-data
node "ocp-infra-node-b7pl" cordoned
WARNING: Deleting pods with local storage: docker-registry-1-5szjs
pod "docker-registry-1-5szjs" evicted
pod "router-1-vzlzq" evicted
node "ocp-infra-node-b7pl" drained</pre>
</div>
</div>
<div class="paragraph">
<p>If the pod has attached local storage (for example, <code>EmptyDir</code>), the
<code>--delete-local-data</code> option must be provided. Generally, pods running in
production should use the local storage only for temporary or cache files, but
not for anything important or persistent. For regular storage, applications
should use object storage or persistent volumes. In this case, the
<code>docker-registry</code> pod&#8217;s local storage is empty, because the object storage is
used instead to store the container images.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The above operation deletes existing pods running on the node. Then, new pods
are created according to the replication controller.</p>
</div>
<div class="paragraph">
<p>In general, every application should be deployed with a deployment
configuration, which creates pods using the replication controller.</p>
</div>
<div class="paragraph">
<p><code>oc adm drain</code> will not delete any bare pods (pods that are neither mirror pods
nor managed by <code>ReplicationController</code>, <code>ReplicaSet</code>, <code>DaemonSet</code>,
<code>StatefulSet</code>, or a job). To do so, the <code>--force</code> option is required. Be aware
that the bare pods will not be recreated on other nodes and data may be lost
during this operation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The example below shows the output of the replication controller of the
registry:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc describe rc/docker-registry-1
Name:		docker-registry-1
Namespace:	default
Selector:	deployment=docker-registry-1,deploymentconfig=docker-registry,docker-registry=default
Labels:		docker-registry=default
		openshift.io/deployment-config.name=docker-registry
Annotations: ...
Replicas:	3 current / 3 desired
Pods Status:	3 Running / 0 Waiting / 0 Succeeded / 0 Failed
Pod Template:
  Labels:		deployment=docker-registry-1
			deploymentconfig=docker-registry
			docker-registry=default
  Annotations:		openshift.io/deployment-config.latest-version=1
			openshift.io/deployment-config.name=docker-registry
			openshift.io/deployment.name=docker-registry-1
  Service Account:	registry
  Containers:
   registry:
    Image:	openshift3/ose-docker-registry:v3.6.173.0.49
    Port:	5000/TCP
    Requests:
      cpu:	100m
      memory:	256Mi
    Liveness:	http-get https://:5000/healthz delay=10s timeout=5s period=10s #success=1 #failure=3
    Readiness:	http-get https://:5000/healthz delay=0s timeout=5s period=10s #success=1 #failure=3
    Environment:
      REGISTRY_HTTP_ADDR:					:5000
      REGISTRY_HTTP_NET:					tcp
      REGISTRY_HTTP_SECRET:					tyGEnDZmc8dQfioP3WkNd5z+Xbdfy/JVXf/NLo3s/zE=
      REGISTRY_MIDDLEWARE_REPOSITORY_OPENSHIFT_ENFORCEQUOTA:	false
      REGISTRY_HTTP_TLS_KEY:					/etc/secrets/registry.key
      OPENSHIFT_DEFAULT_REGISTRY:				docker-registry.default.svc:5000
      REGISTRY_CONFIGURATION_PATH:				/etc/registry/config.yml
      REGISTRY_HTTP_TLS_CERTIFICATE:				/etc/secrets/registry.crt
    Mounts:
      /etc/registry from docker-config (rw)
      /etc/secrets from registry-certificates (rw)
      /registry from registry-storage (rw)
  Volumes:
   registry-storage:
    Type:	EmptyDir (a temporary directory that shares a pod's lifetime)
    Medium:
   registry-certificates:
    Type:	Secret (a volume populated by a Secret)
    SecretName:	registry-certificates
    Optional:	false
   docker-config:
    Type:	Secret (a volume populated by a Secret)
    SecretName:	registry-config
    Optional:	false
Events:
  FirstSeen	LastSeen	Count	From			SubObjectPath	Type		Reason		Message
  ---------	--------	-----	----			-------------	--------	------		-------
  49m		49m		1	replication-controller			Normal		SuccessfulCreate	Created pod: docker-registry-1-dprp5</pre>
</div>
</div>
<div class="paragraph">
<p>The event at the bottom of the output displays information about new pod
creation. So, when listing all pods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get pods
NAME                       READY     STATUS    RESTARTS   AGE
docker-registry-1-dprp5    1/1       Running   0          52m
docker-registry-1-kr8jq    1/1       Running   0          1d
docker-registry-1-ncpl2    1/1       Running   0          1d
registry-console-1-g4nqg   1/1       Running   0          1d
router-1-2gshr             0/1       Pending   0          52m
router-1-85qm4             1/1       Running   0          1d
router-1-q5sr8             1/1       Running   0          1d</pre>
</div>
</div>
</li>
<li>
<p>The <code>docker-registry-1-5szjs</code> and <code>router-1-vzlzq</code> pods that were running on
the now deprecated node are no longer available. Instead, two new pods have been
created: <code>docker-registry-1-dprp5</code> and <code>router-1-2gshr</code>. As shown above, the new
router pod is <code>router-1-2gshr</code>, but is in the <code>Pending</code> state. This is because
every node can be running only on one single router and is bound to the ports 80
and 443 of the host.</p>
</li>
<li>
<p>When observing the newly created registry pod, the example below shows that
the pod has been created on the <code>ocp-infra-node-rghb</code> node, which is different
from the deprecating node:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc describe pod docker-registry-1-dprp5
Name:			docker-registry-1-dprp5
Namespace:		default
Security Policy:	hostnetwork
Node:			ocp-infra-node-rghb/10.156.0.10
...</pre>
</div>
</div>
<div class="paragraph">
<p>The only difference between deprecating the infrastructure and the application
node is that once the infrastructure node is evacuated, and if there is no plan
to replace that node, the services running on infrastructure nodes can be scaled
down:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc scale dc/router --replicas 2
deploymentconfig "router" scaled

$ oc scale dc/docker-registry --replicas 2
deploymentconfig "docker-registry" scaled</pre>
</div>
</div>
</li>
<li>
<p>Now, every infrastructure node is running only one kind of each pod:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get pods
NAME                       READY     STATUS    RESTARTS   AGE
docker-registry-1-kr8jq    1/1       Running   0          1d
docker-registry-1-ncpl2    1/1       Running   0          1d
registry-console-1-g4nqg   1/1       Running   0          1d
router-1-85qm4             1/1       Running   0          1d
router-1-q5sr8             1/1       Running   0          1d

$ oc describe po/docker-registry-1-kr8jq | grep Node:
Node:			ocp-infra-node-p5zj/10.156.0.9

$ oc describe po/docker-registry-1-ncpl2 | grep Node:
Node:			ocp-infra-node-rghb/10.156.0.10</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To provide a full highly available cluster, at least three infrastructure nodes
should always be available.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>To verify that the scheduling on the node is disabled:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get nodes
NAME                  STATUS                     AGE       VERSION
ocp-infra-node-b7pl   Ready,SchedulingDisabled   1d        v1.6.1+5115d708d7
ocp-infra-node-p5zj   Ready                      1d        v1.6.1+5115d708d7
ocp-infra-node-rghb   Ready                      1d        v1.6.1+5115d708d7
ocp-master-dgf8       Ready,SchedulingDisabled   1d        v1.6.1+5115d708d7
ocp-master-q1v2       Ready,SchedulingDisabled   1d        v1.6.1+5115d708d7
ocp-master-vq70       Ready,SchedulingDisabled   1d        v1.6.1+5115d708d7
ocp-node-020m         Ready                      1d        v1.6.1+5115d708d7
ocp-node-7t5p         Ready                      1d        v1.6.1+5115d708d7
ocp-node-n0dd         Ready                      1d        v1.6.1+5115d708d7</pre>
</div>
</div>
<div class="paragraph">
<p>And that the node does not contain any pods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc describe node ocp-infra-node-b7pl
Name:			ocp-infra-node-b7pl
Role:
Labels:			beta.kubernetes.io/arch=amd64
			beta.kubernetes.io/instance-type=n1-standard-2
			beta.kubernetes.io/os=linux
			failure-domain.beta.kubernetes.io/region=europe-west3
			failure-domain.beta.kubernetes.io/zone=europe-west3-c
			kubernetes.io/hostname=ocp-infra-node-b7pl
			role=infra
Annotations:		volumes.kubernetes.io/controller-managed-attach-detach=true
Taints:			&lt;none&gt;
CreationTimestamp:	Wed, 22 Nov 2017 09:36:36 -0500
Phase:
Conditions:
  ...
Addresses:		10.156.0.11,ocp-infra-node-b7pl
Capacity:
 cpu:		2
 memory:	7494480Ki
 pods:		20
Allocatable:
 cpu:		2
 memory:	7392080Ki
 pods:		20
System Info:
 Machine ID:			bc95ccf67d047f2ae42c67862c202e44
 System UUID:			9762CC3D-E23C-AB13-B8C5-FA16F0BCCE4C
 Boot ID:			ca8bf088-905d-4ec0-beec-8f89f4527ce4
 Kernel Version:		3.10.0-693.5.2.el7.x86_64
 OS Image:			Employee SKU
 Operating System:		linux
 Architecture:			amd64
 Container Runtime Version:	docker://1.12.6
 Kubelet Version:		v1.6.1+5115d708d7
 Kube-Proxy Version:		v1.6.1+5115d708d7
ExternalID:			437740049672994824
Non-terminated Pods:		(0 in total)
  Namespace			Name		CPU Requests	CPU Limits	Memory Requests	Memory Limits
  ---------			----		------------	----------	---------------	-------------
Allocated resources:
  (Total limits may be over 100 percent, i.e., overcommitted.)
  CPU Requests	CPU Limits	Memory Requests	Memory Limits
  ------------	----------	---------------	-------------
  0 (0%)	0 (0%)		0 (0%)		0 (0%)
Events:		&lt;none&gt;</pre>
</div>
</div>
</li>
<li>
<p>Remove the infrastructure instance from the <code>backend</code> section in the <code>/etc/haproxy/haproxy.cfg</code> configuration file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">backend router80
    balance source
    mode tcp
    server infra-1.example.com 192.168.55.12:80 check
    server infra-2.example.com 192.168.55.13:80 check

backend router443
    balance source
    mode tcp
    server infra-1.example.com 192.168.55.12:443 check
    server infra-2.example.com 192.168.55.13:443 check</pre>
</div>
</div>
</li>
<li>
<p>Then, restart the <code>haproxy</code> service.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ sudo systemctl restart haproxy</pre>
</div>
</div>
</li>
<li>
<p>Remove the node from the cluster after all pods are evicted with command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc delete node ocp-infra-node-b7pl
node "ocp-infra-node-b7pl" deleted</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get nodes
NAME                  STATUS                     AGE       VERSION
ocp-infra-node-p5zj   Ready                      1d        v1.6.1+5115d708d7
ocp-infra-node-rghb   Ready                      1d        v1.6.1+5115d708d7
ocp-master-dgf8       Ready,SchedulingDisabled   1d        v1.6.1+5115d708d7
ocp-master-q1v2       Ready,SchedulingDisabled   1d        v1.6.1+5115d708d7
ocp-master-vq70       Ready,SchedulingDisabled   1d        v1.6.1+5115d708d7
ocp-node-020m         Ready                      1d        v1.6.1+5115d708d7
ocp-node-7t5p         Ready                      1d        v1.6.1+5115d708d7
ocp-node-n0dd         Ready                      1d        v1.6.1+5115d708d7</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For more information on evacuating and draining pods or nodes, see
<a href="../day_two_guide/host_level_tasks.adic.html#day-two-guide-node-maintenance">Node maintenance</a> section.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="replacing-a-node-host"><a class="anchor" href="#replacing-a-node-host"></a>Replacing a node host</h4>
<div class="paragraph">
<p>In the event that a node would need to be added in place of the deprecated node,
follow the
<a href="../install_config/adding_hosts_to_existing_cluster.html#install-config-adding-hosts-to-cluster">Adding
hosts to an existing cluster</a> section.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="day-two-guide-node-backup"><a class="anchor" href="#day-two-guide-node-backup"></a>Creating a node host backup</h3>
<div class="paragraph">
<p>The backup process is to be performed before any change to the infrastructure,
such as a system update, upgrade, or any other significant modification. Backups
should be performed on a regular basis to ensure the most recent data is
available if a failure occurs.</p>
</div>
<div class="paragraph">
<p><strong>OpenShift Origin files</strong></p>
</div>
<div class="paragraph">
<p>Node instances run applications in the form of pods, which are based on
containers. The <code>/etc/origin/</code> and <code>/etc/origin/node</code> directories house
important files, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The configuration of the node services</p>
</li>
<li>
<p>Certificates generated by the installation</p>
</li>
<li>
<p>Cloud provider-related configuration</p>
</li>
<li>
<p>Keys and other authentication files, such as the <code>dnsmasq</code> configuration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The OpenShift Origin services can be customized to increase the log level, use
proxies, and more, and the configuration files are stored in the
<code>/etc/sysconfig</code> directory.</p>
</div>
<h2 id="procedure-5" class="discrete">Procedure</h2>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a backup of the node configuration files:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ MYBACKUPDIR=/backup/$(hostname)/$(date +%Y%m%d)
$ sudo mkdir -p ${MYBACKUPDIR}/etc/sysconfig
$ sudo cp -aR /etc/origin ${MYBACKUPDIR}/etc
$ sudo cp -aR /etc/sysconfig/atomic-openshift-node ${MYBACKUPDIR}/etc/sysconfig/</pre>
</div>
</div>
</li>
<li>
<p>OpenShift Origin uses specific files that must be taken into account when
planning the backup policy, including:</p>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">File</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/etc/cni/*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container Network Interface configuration (if used)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/etc/sysconfig/iptables</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where the <code>iptables</code> rules are stored</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/etc/sysconfig/docker-storage-setup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The input file for <code>container-storage-setup</code> command</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/etc/sysconfig/docker</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>docker</code> configuration file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/etc/sysconfig/docker-network</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker</code> networking configuration (i.e. MTU)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/etc/sysconfig/docker-storage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker</code> storage configuration (generated by <code>container-storage-setup</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/etc/dnsmasq.conf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Main configuration file for <code>dnsmasq</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/etc/dnsmasq.d/*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Different <code>dnsmasq</code> configuration files</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/etc/sysconfig/flanneld</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>flannel</code> configuration file (if used)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/etc/pki/ca-trust/source/anchors/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Certificates added to the system (i.e. for external registries)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To create those files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ MYBACKUPDIR=/backup/$(hostname)/$(date +%Y%m%d)
$ sudo mkdir -p ${MYBACKUPDIR}/etc/sysconfig
$ sudo mkdir -p ${MYBACKUPDIR}/etc/pki/ca-trust/source/anchors
$ sudo cp -aR /etc/sysconfig/{iptables,docker-*,flanneld} \
    ${MYBACKUPDIR}/etc/sysconfig/
$ sudo cp -aR /etc/dnsmasq* /etc/cni ${MYBACKUPDIR}/etc/
$ sudo cp -aR /etc/pki/ca-trust/source/anchors/* \
    ${MYBACKUPDIR}/etc/pki/ca-trust/source/anchors/</pre>
</div>
</div>
</li>
<li>
<p>If a package is accidentally removed, or a file included in an <code>rpm</code>
package should be restored, having a list of <code>rhel</code> packages installed on the
system can be useful.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If using Red Hat Satellite features, such as content views or the facts store,
provide a proper mechanism to reinstall the missing packages and a historical
data of packages installed in the systems.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To create a list of the current <code>rhel</code> packages installed in the system:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ MYBACKUPDIR=/backup/$(hostname)/$(date +%Y%m%d)
$ sudo mkdir -p ${MYBACKUPDIR}
$ rpm -qa | sort | sudo tee $MYBACKUPDIR/packages.txt</pre>
</div>
</div>
</li>
<li>
<p>The following files should now be present in the backup directory:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ MYBACKUPDIR=*/backup/$(hostname)/$(date +%Y%m%d)*
$ sudo find ${MYBACKUPDIR} -mindepth 1 -type f -printf '%P\n'
etc/sysconfig/atomic-openshift-node
etc/sysconfig/flanneld
etc/sysconfig/iptables
etc/sysconfig/docker-network
etc/sysconfig/docker-storage
etc/sysconfig/docker-storage-setup
etc/sysconfig/docker-storage-setup.rpmnew
etc/origin/node/system:node:app-node-0.example.com.crt
etc/origin/node/system:node:app-node-0.example.com.key
etc/origin/node/ca.crt
etc/origin/node/system:node:app-node-0.example.com.kubeconfig
etc/origin/node/server.crt
etc/origin/node/server.key
etc/origin/node/node-dnsmasq.conf
etc/origin/node/resolv.conf
etc/origin/node/node-config.yaml
etc/origin/node/flannel.etcd-client.key
etc/origin/node/flannel.etcd-client.csr
etc/origin/node/flannel.etcd-client.crt
etc/origin/node/flannel.etcd-ca.crt
etc/origin/cloudprovider/openstack.conf
etc/pki/ca-trust/source/anchors/openshift-ca.crt
etc/pki/ca-trust/source/anchors/registry-ca.crt
etc/dnsmasq.conf
etc/dnsmasq.d/origin-dns.conf
etc/dnsmasq.d/origin-upstream-dns.conf
etc/dnsmasq.d/node-dnsmasq.conf
packages.txt</pre>
</div>
</div>
<div class="paragraph">
<p>If needed, the files can be compressed to save space:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ MYBACKUPDIR=*/backup/$(hostname)/$(date +%Y%m%d)*
$ sudo tar -zcvf */backup/*$(hostname)-$(date +%Y%m%d).tar.gz $MYBACKUPDIR
$ sudo rm -Rf ${MYBACKUPDIR}</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>To create any of these files from scratch, the <code>openshift-ansible-contrib</code>
repository contains the <code>backup_master_node.sh</code> script, which performs the
previous steps. The script creates a directory on the host running the script
and copies all the files previously mentioned.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>openshift-ansible-contrib</code> script is not supported by Red Hat, but the
reference architecture team performs testing to ensure the code operates as
defined and is secure.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The script can be executed on every master host with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ mkdir ~/git
$ cd ~/git
$ git clone https://github.com/openshift/openshift-ansible-contrib.git
$ cd openshift-ansible-contrib/reference-architecture/day2ops/scripts
$ ./backup_master_node.sh -h</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="day-two-guide-restore-node"><a class="anchor" href="#day-two-guide-restore-node"></a>Restoring a node host backup</h3>
<div class="paragraph">
<p>After creating a backup of important node host files, if they become corrupted
or accidentally removed, you can restore the file by copying back the file,
ensuring it contains the proper content and restart the affected services.</p>
</div>
<h2 id="procedure-6" class="discrete">Procedure</h2>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Restore the <code>/etc/origin/node/node-config.yaml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># MYBACKUPDIR=/backup/$(hostname)/$(date +%Y%m%d)
# cp /etc/origin/node/node-config.yaml /etc/origin/node/node-config.yaml.old
# cp /backup/$(hostname)/$(date +%Y%m%d)/etc/origin/node/node-config.yaml /etc/origin/node/node-config.yaml
# systemctl restart atomic-openshift-node</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Restarting the services can lead to downtime. See
<a href="../day_two_guide/host_level_tasks.html#day-two-guide-node-maintenance">Node
maintenance</a>, for tips on how to ease the process.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Perform a full reboot of the affected instance to restore the <code>iptables</code>
configuration.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the issue is an accidental package and its dependencies are removed, reinstall the package.</p>
<div class="paragraph">
<p>Get the list of the current installed packages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ rpm -qa | sort &gt; /tmp/current_packages.txt</pre>
</div>
</div>
</li>
<li>
<p>Get the differences:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ diff /tmp/current_packages.txt ${MYBACKUPDIR}/packages.txt
1a2
&gt; ansible-2.4.0.0-5.el7.noarch</pre>
</div>
</div>
</li>
<li>
<p>Reinstall the missing packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum reinstall -y ansible-2.4.0.0-5.el7.noarch</pre>
</div>
</div>
</li>
<li>
<p>Restore a system certificate by copying the certificate to the
<code>/etc/pki/ca-trust/source/anchors/</code> directory and execute the <code>update-ca-trust</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ MYBACKUPDIR=*/backup/$(hostname)/$(date +%Y%m%d)*
$ sudo cp ${MYBACKUPDIR}/etc/pki/ca-trust/source/anchors/my_company.crt /etc/pki/ca-trust/source/anchors/
$ sudo update-ca-trust</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Always ensure proper user ID and group ID are restored when the files are copied
back, as well as the <code>SELinux</code> context.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="day-two-guide-node-maintenance"><a class="anchor" href="#day-two-guide-node-maintenance"></a>Node maintenance</h3>
<div class="paragraph">
<p>See <a href="../admin_guide/manage_nodes.html#admin-guide-manage-nodes">Managing nodes</a> or
<a href="../admin_guide/manage_pods.html#admin-guide-manage-pods">Managing pods</a> topics
for various node management options. These include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../admin_guide/manage_nodes.html#marking-nodes-as-unschedulable-or-schedulable">Marking Nodes as Unschedulable or Schedulable</a></p>
</li>
<li>
<p><a href="../admin_guide/manage_nodes.html#evacuating-pods-on-nodes">Evacuating Pods on Nodes</a></p>
</li>
<li>
<p><a href="../admin_guide/manage_pods.html#managing-pods-poddisruptionbudget">Setting Pod Disruption Budgets</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="day-two-guide-etcd-backup"><a class="anchor" href="#day-two-guide-etcd-backup"></a>etcd tasks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>etcd is the key value store for all object definitions, as well as the
persistent master state. Other components watch for changes, then bring
themselves into the desired state.</p>
</div>
<div class="paragraph">
<p>OpenShift Origin versions prior to 3.5 used etcd version 2 (v2), while 3.5 and
later use version 3 (v3). The data model between the two versions of etcd is
different. etcd v3 can use both the v2 and v3 data model, whereas etcd v2 can
only use the v2 data model. In an etcd v3 server, the v2 and v3 data stores
exist in parallel and are independent.</p>
</div>
<div class="paragraph">
<p>For both v2 and v3 operations, you can use the <code>ETCDCTL_API</code> environment
variable to use the proper API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ etcdctl -v
etcdctl version: 3.2.5
API version: 2
$ ETCDCTL_API=3 etcdctl version
etcdctl version: 3.2.5
API version: 3.2</pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#../install_config/upgrading/migrating_etcd.adoc">Migrating etcd Data (v2
to v3) section</a> for information about how to migrate to v3.</p>
</div>
<div class="sect2">
<h3 id="back-up-and-restore-etcd"><a class="anchor" href="#back-up-and-restore-etcd"></a>Back up and restore etcd</h3>
<div class="paragraph">
<p>The etcd backup process is composed of two different procedures:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configuration backup: Including the required etcd configuration and
certificates</p>
</li>
<li>
<p>Data backup: Including both v2 and v3 data model.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The data backup procedure can be done on any host that has connectivity to the
etcd cluster, where the proper certificates are provided, and where the
<code>etcdctl</code> tool is installed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The backup files must be copied to an external system, ideally outside the
OpenShift Origin environment, and then encrypted.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="etcd-configuration-backup"><a class="anchor" href="#etcd-configuration-backup"></a>etcd configuration backup</h4>
<div class="paragraph">
<p>The etcd configuration files to be preserved are all stored in the <code>/etc/etcd</code>
directory of the instances where etcd is running. This includes the etcd
configuration file (<code>/etc/etcd/etcd.conf</code>) and the required certificates for
cluster communication. All those files are generated at installation time by the
Ansible installer.</p>
</div>
<div class="paragraph">
<p>To back up the etcd configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ ssh master-0
# mkdir -p /backup/etcd-config-$(date +%Y%m%d)/
# cp -R /etc/etcd/ /backup/etcd-config-$(date +%Y%m%d)/</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The backup is to be performed on every etcd member of the cluster
as the certificates and configuration files are unique.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="etcd-configuration-restore"><a class="anchor" href="#etcd-configuration-restore"></a>etcd configuration restore</h4>
<div class="paragraph">
<p>The restore procedure for etcd configuration files replaces the appropriate
files, then restarts the service.</p>
</div>
<div class="paragraph">
<p>If an etcd host has become corrupted and the <code>/etc/etcd/etcd.conf</code> file is lost,
restore it using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ ssh master-0
# cp /backup/yesterday/master-0-files/etcd.conf /etc/etcd/etcd.conf
# restorecon -Rv /etc/etcd/etcd.conf
# systemctl restart etcd.service</pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the backup file is stored in the
<code>/backup/yesterday/master-0-files/etcd.conf</code> path where it can be used as an
external NFS share, S3 bucket, etc.</p>
</div>
</div>
<div class="sect3">
<h4 id="etcd-data-backup"><a class="anchor" href="#etcd-data-backup"></a>etcd data backup</h4>
<h2 id="prerequisites-2" class="discrete">Prerequisites</h2>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The OpenShift Origin installer creates aliases to avoid typing all the
flags named <code>etcdctl2</code> for etcd v2 tasks and <code>etcdctl3</code> for etcd v3 tasks.</p>
</div>
<div class="paragraph">
<p>However, the <code>etcdctl3</code> alias does not provide the full endpoint list to the
<code>etcdctl</code> command, so the <code>--endpoints</code> option with all the endpoints must be
provided.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Before backing up etcd:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>etcdctl</code> binaries should be available or, in containerized installations, the <code>rhel7/etcd</code> container should be available</p>
</li>
<li>
<p>Ensure connectivity with the etcd cluster (port 2379/tcp)</p>
</li>
<li>
<p>Ensure the proper certificates to connect to the etcd cluster</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To ensure the etcd cluster is working, check its health:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># etcdctl --cert-file=/etc/etcd/peer.crt \
          --key-file=/etc/etcd/peer.key \
          --ca-file=/etc/etcd/ca.crt \
          --peers="https://*master-0.example.com*:2379,\
          https://*master-1.example.com*:2379,\
          https://*master-2.example.com*:2379"\
          cluster-health
member 5ee217d19001 is healthy: got healthy result from https://192.168.55.12:2379
member 2a529ba1840722c0 is healthy: got healthy result from https://192.168.55.8:2379
member ed4f0efd277d7599 is healthy: got healthy result from https://192.168.55.13:2379
cluster is healthy</pre>
</div>
</div>
<div class="paragraph">
<p>Or if using the etcd v3 API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ETCDCTL_API=3 etcdctl --cert="/etc/etcd/peer.crt" \
          --key=/etc/etcd/peer.key \
          --cacert="/etc/etcd/ca.crt" \
          --endpoints="https://*master-0.example.com*:2379,\
            https://*master-1.example.com*:2379,\
            https://*master-2.example.com*:2379"
            endpoint health
https://master-0.example.com:2379 is healthy: successfully committed proposal: took = 5.011358ms
https://master-1.example.com:2379 is healthy: successfully committed proposal: took = 1.305173ms
https://master-2.example.com:2379 is healthy: successfully committed proposal: took = 1.388772ms</pre>
</div>
</div>
</li>
<li>
<p>Check the member list:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># etcdctl2 member list
2a371dd20f21ca8d: name=master-1.example.com peerURLs=https://192.168.55.12:2380 clientURLs=https://192.168.55.12:2379 isLeader=false
40bef1f6c79b3163: name=master-0.example.com peerURLs=https://192.168.55.8:2380 clientURLs=https://192.168.55.8:2379 isLeader=false
95dc17ffcce8ee29: name=master-2.example.com peerURLs=https://192.168.55.13:2380 clientURLs=https://192.168.55.13:2379 isLeader=true</pre>
</div>
</div>
<div class="paragraph">
<p>Or, if using etcd the v3 API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># etcdctl3 member list
2a371dd20f21ca8d, started, master-1.example.com, https://192.168.55.12:2380, https://192.168.55.12:2379
40bef1f6c79b3163, started, master-0.example.com, https://192.168.55.8:2380, https://192.168.55.8:2379
95dc17ffcce8ee29, started, master-2.example.com, https://192.168.55.13:2380, https://192.168.55.13:2379</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
<h2 id="procedure-7" class="discrete">Procedure</h2>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>While the <code>etcdctl backup</code> command is used to perform the backup, etcd v3 has
no concept of a "backup". Instead, a "snapshot" may either be taken from a live
member with the <code>etcdctl snapshot save</code> command or by copying the
<code>member/snap/db</code> file from an etcd data directory.</p>
</div>
<div class="paragraph">
<p>The <code>etcdctl backup</code> command rewrites some of the metadata contained in the
backup (specifically, the node ID and cluster ID), which means that in the
backup, the node loses its former identity. In order to recreate a cluster from
the backup, a new, single-node cluster is created, then the rest of the nodes
join the cluster. The metadata is rewritten to prevent the new node from
inadvertently being joined onto an existing cluster.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Perform the backup:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir -p */backup/etcd-$(date +%Y%m%d)*
# systemctl stop etcd.service
# etcdctl2 backup \
    --data-dir /var/lib/etcd \
    --backup-dir */backup/etcd-$(date +%Y%m%d)*
# cp /var/lib/etcd/member/snap/db */backup/etcd-$(date +%Y%m%d)*
# systemctl start etcd.service</pre>
</div>
</div>
<div class="paragraph">
<p>While stopping the etcd service is not strictly necessary, doing so ensures that
the etcd data is fully synchronized.</p>
</div>
<div class="paragraph">
<p>The <code>etcdctl2 backup</code> command creates etcd v2 data backup where copying the <code>db</code>
file while the etcd service is not running is equivalent to running <code>etcdctl3
snapshot</code> for etcd v3 data backup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir -p */backup/etcd-$(date +%Y%m%d)*
# etcdctl3 snapshot save */backup/etcd-$(date +%Y%m%d)*/db
Snapshot saved at /backup/etcd-&lt;date&gt;/db
# systemctl stop etcd.service
# etcdctl2 backup \
    --data-dir /var/lib/etcd \
    --backup-dir */backup/etcd-$(date +%Y%m%d)*
# systemctl start etcd.service</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>etcdctl snapshot save</code> command requires the etcd service to be running.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this example, a <code>/backup/etcd-&lt;date&gt;/</code> directory is created, where <code>&lt;date&gt;</code>
represents the current date, which must be an external NFS share, S3 bucket, or
any external storage location.</p>
</div>
<div class="paragraph">
<p>In the case of an all-in-one cluster, the etcd data directory is located in
<code>/var/lib/origin/openshift.local.etcd</code></p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="restoring-etcd-v2-v3-data"><a class="anchor" href="#restoring-etcd-v2-v3-data"></a>Restoring etcd v2 &amp; v3 data</h4>
<div class="paragraph">
<p>The following restores healthy data files and starts the etcd cluster as a
single node, then adds the rest of the nodes in case an etcd cluster is
required.</p>
</div>
<h2 id="procedure-8" class="discrete">Procedure</h2>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Stop all etcd services:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl stop etcd.service</pre>
</div>
</div>
</li>
<li>
<p>Clean the etcd data directories to ensure the proper backup is restored, but
keeping the running copy:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mv /var/lib/etcd /var/lib/etcd.old
# mkdir /var/lib/etcd
# chown -R etcd.etcd /var/lib/etcd/
# restorecon -Rv /var/lib/etcd/</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can wipe the etcd data directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># rm -Rf /var/lib/etcd/*</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In case an all-in-one cluster, the etcd data directory is located in
<code>/var/lib/origin/openshift.local.etcd</code></p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Restore a healthy backup data file to one of the etcd nodes:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp -R /backup/etcd-xxx/* /var/lib/etcd/
# mv /var/lib/etcd/db /var/lib/etcd/member/snap/db</pre>
</div>
</div>
<div class="paragraph">
<p>Perform this step on all etcd hosts (including master hosts collocated with
etcd).</p>
</div>
</li>
<li>
<p>Run the etcd service, forcing a new cluster.</p>
<div class="paragraph">
<p>This creates a custom file for the etcd service, which overwrites the execution
command adding the <code>--force-new-cluster</code> option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir -p /etc/systemd/system/etcd.service.d/
# echo "[Service]" &gt; /etc/systemd/system/etcd.service.d/temp.conf
# echo "ExecStart=" &gt;&gt; /etc/systemd/system/etcd.service.d/temp.conf
# sed -n '/ExecStart/s/"$/ --force-new-cluster"/p' \
    /usr/lib/systemd/system/etcd.service \
    &gt;&gt; /etc/systemd/system/etcd.service.d/temp.conf

# systemctl daemon-reload
# systemctl restart etcd</pre>
</div>
</div>
</li>
<li>
<p>Check for error messages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ journalctl -fu etcd.service</pre>
</div>
</div>
</li>
<li>
<p>Check for health status (in this case, a single node):</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># etcdctl2 cluster-health
member 5ee217d17301 is healthy: got healthy result from https://192.168.55.8:2379
cluster is healthy</pre>
</div>
</div>
</li>
<li>
<p>Restart the etcd service in cluster mode:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># rm -f /etc/systemd/system/etcd.service.d/temp.conf
# systemctl daemon-reload
# systemctl restart etcd</pre>
</div>
</div>
</li>
<li>
<p>Check for health status and member list</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># etcdctl2 cluster-health
member 5ee217d17301 is healthy: got healthy result from https://192.168.55.8:2379
cluster is healthy

# etcdctl2 member list
5ee217d17301: name=master-0.example.com peerURLs=http://localhost:2380 clientURLs=https://192.168.55.8:2379 isLeader=true</pre>
</div>
</div>
</li>
<li>
<p>Once the first instance is running, it is safe to restore multiple etcd servers as desired.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Fix the <code>peerURLS</code> parameter</strong></p>
</div>
<div class="paragraph">
<p>After restoring the data and creating a new cluster, the <code>peerURLs</code> parameter
shows <code>localhost</code> instead the IP where etcd is listening for peer
communication:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># etcdctl2 member list
5ee217d17301: name=master-0.example.com peerURLs=http://*localhost*:2380 clientURLs=https://192.168.55.8:2379 isLeader=true</pre>
</div>
</div>
<h2 id="procedure-9" class="discrete">Procedure</h2>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Get the member ID from the <code>etcdctl member list</code> output.</p>
</li>
<li>
<p>Get the IP where etcd is listening for peer communication:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ ss -l4n | grep 2380</pre>
</div>
</div>
</li>
<li>
<p>Update the member information with that IP:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># etcdctl2 member update *5ee217d17301* https://*192.168.55.8*:2380
Updated member with ID 5ee217d17301 in cluster</pre>
</div>
</div>
</li>
<li>
<p>To verify, check that the IP is in the output of the following:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ etcdctl2 member list
5ee217d17301: name=master-0.example.com peerURLs=https://*192.168.55.8*:2380 clientURLs=https://192.168.55.8:2379 isLeader=true</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Add more members</strong></p>
</div>
<div class="paragraph">
<p>In the instance joining the cluster:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Get the etcd name for the instance in the <code>ETCD_NAME</code> variable:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># grep ETCD_NAME /etc/etcd/etcd.conf</pre>
</div>
</div>
</li>
<li>
<p>Get the IP where etcd listens for peer communication:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># grep ETCD_INITIAL_ADVERTISE_PEER_URLS /etc/etcd/etcd.conf</pre>
</div>
</div>
</li>
<li>
<p>Delete the previous etcd data:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># rm -Rf /var/lib/etcd/*</pre>
</div>
</div>
</li>
<li>
<p>On the etcd host where etcd is properly running, add the new member:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ etcdctl2 member add &lt;name&gt; &lt;advertise_peer_urls&gt;</pre>
</div>
</div>
</li>
<li>
<p>The command outputs some variables. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">ETCD_NAME="master2"
ETCD_INITIAL_CLUSTER="master1=https://10.0.0.7:2380,master2=https://10.0.0.5:2380"
ETCD_INITIAL_CLUSTER_STATE="existing"</pre>
</div>
</div>
<div class="paragraph">
<p>Add those values to the <code>/etc/etcd/etcd.conf</code> file of the new host:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vi /etc/etc/etcd.conf</pre>
</div>
</div>
</li>
<li>
<p>Once those values are replaced, start the etcd service in the node joining
the cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl start etcd.service</pre>
</div>
</div>
</li>
<li>
<p>Check for error messages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ journalctl -fu etcd.service</pre>
</div>
</div>
</li>
<li>
<p>Repeat the above for every etcd node joining the cluster.</p>
</li>
<li>
<p>Verify the cluster status and cluster health once all the nodes joined:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># etcdctl2 member list
5cd050b4d701: name=master1 peerURLs=https://10.0.0.7:2380 clientURLs=https://10.0.0.7:2379 isLeader=true
d0c57659d8990cbd: name=master2 peerURLs=https://10.0.0.5:2380 clientURLs=https://10.0.0.5:2379 isLeader=false
e4696d637de3eb2d: name=master3 peerURLs=https://10.0.0.6:2380 clientURLs=https://10.0.0.6:2379 isLeader=false</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># etcdctl2 cluster-health
member 5cd050b4d701 is healthy: got healthy result from https://10.0.0.7:2379
member d0c57659d8990cbd is healthy: got healthy result from https://10.0.0.5:2379
member e4696d637de3eb2d is healthy: got healthy result from https://10.0.0.6:2379
cluster is healthy</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="restoring-etcd-for-v3"><a class="anchor" href="#restoring-etcd-for-v3"></a>Restoring etcd for v3</h4>
<div class="paragraph">
<p>The restore procedure for v3 data is similar to the v2 data.</p>
</div>
<div class="paragraph">
<p>Snapshot integrity may be optionally verified at restore time. If the snapshot
is taken with <code>etcdctl snapshot save</code>, it will have an integrity hash that is
checked by <code>etcdctl snapshot restore</code>. If the snapshot is copied from the data
directory, there is no integrity hash and it will only restore by using
<code>--skip-hash-check</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The procedure to restore only the v3 data must be performed on a single etcd
host. You can then add the rest of the nodes to the cluster.</p>
</div>
</td>
</tr>
</table>
</div>
<h2 id="procedure-10" class="discrete">Procedure</h2>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Stop all etcd services:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl stop etcd.service</pre>
</div>
</div>
</li>
<li>
<p>Clear all old data, because <code>etcdctl</code> recreates it in the node where the
restore procedure is going to be performed:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># rm -Rf /var/lib/etcd</pre>
</div>
</div>
</li>
<li>
<p>Use the <code>snapshot restore</code> command with the data from <code>/etc/etcd/etcd.conf</code> to
match the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># etcdctl3 snapshot restore */backup/etcd-xxxxxx/backup.db* \
  --data-dir /var/lib/etcd \
  --name *master-0.example.com* \
  --initial-cluster *"master-0.example.com=https://192.168.55.8:2380"* \ --initial-cluster-token *"etcd-cluster-1"* \
  --initial-advertise-peer-urls *https://192.168.55.8:2380*

2017-10-03 08:55:32.440779 I | mvcc: restore compact to 1041269
2017-10-03 08:55:32.468244 I | etcdserver/membership: added member 40bef1f6c79b3163 [https://192.168.55.8:2380] to cluster 26841ebcf610583c</pre>
</div>
</div>
</li>
<li>
<p>Restore permissions and <code>selinux</code> context to the restored files:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chown -R etcd.etcd /var/lib/etcd/
# restorecon -Rv /var/lib/etcd</pre>
</div>
</div>
</li>
<li>
<p>Start the etcd service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl start etcd</pre>
</div>
</div>
</li>
<li>
<p>Check for any error messages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ journalctl -fu etcd.service</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Adding more nodes</strong></p>
</div>
<div class="paragraph">
<p>Once the first instance is running, it is safe to restore multiple etcd servers as desired.</p>
</div>
<h2 id="procedure-11" class="discrete">Procedure</h2>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Get the etcd name for the instance in the <code>ETCD_NAME</code> variable:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># grep ETCD_NAME /etc/etcd/etcd.conf</pre>
</div>
</div>
</li>
<li>
<p>Get the IP where etcd listens for peer communication:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># grep ETCD_INITIAL_ADVERTISE_PEER_URLS /etc/etcd/etcd.conf</pre>
</div>
</div>
</li>
<li>
<p>On the etcd host where etcd is still running, add the new member:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># etcdctl3 member add *&lt;name&gt;* \
  --peer-urls="*&lt;advertise_peer_urls&gt;*"</pre>
</div>
</div>
</li>
<li>
<p>The command outputs some variables. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">ETCD_NAME="master2"
ETCD_INITIAL_CLUSTER="master-0.example.com=https://192.168.55.8:2380"
ETCD_INITIAL_CLUSTER_STATE="existing"</pre>
</div>
</div>
<div class="paragraph">
<p>Add those values to the <code>/etc/etcd/etcd.conf</code> file of the new host:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vi /etc/etc/etcd.conf</pre>
</div>
</div>
</li>
<li>
<p>In the recently added etcd node, clean the etcd data directories to ensure the
proper backup is restored keeping the running copy:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mv /var/lib/etcd /var/lib/etcd.old
# mkdir /var/lib/etcd
# chown -R etcd.etcd /var/lib/etcd/
# restorecon -Rv /var/lib/etcd/</pre>
</div>
</div>
<div class="paragraph">
<p>or wipe the etcd data directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># rm -Rf /var/lib/etcd/*</pre>
</div>
</div>
</li>
<li>
<p>Start the etcd service in the recently added etcd host:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl start etcd</pre>
</div>
</div>
</li>
<li>
<p>Check for errors:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># journalctl -fu etcd.service</pre>
</div>
</div>
</li>
<li>
<p>Repeat the previous steps for every etcd node that is required to be added.</p>
</li>
<li>
<p>Verify the cluster has been properly set:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># etcdctl3 endpoint health
https://master-0.example.com:2379 is healthy: successfully committed proposal: took = 1.423459ms
https://master-1.example.com:2379 is healthy: successfully committed proposal: took = 1.767481ms
https://master-2.example.com:2379 is healthy: successfully committed proposal: took = 1.599694ms

# etcdctl3 endpoint status
https://master-0.example.com:2379, 40bef1f6c79b3163, 3.2.5, 28 MB, true, 9, 2878
https://master-1.example.com:2379, 1ea57201a3ff620a, 3.2.5, 28 MB, false, 9, 2878
https://master-2.example.com:2379, 59229711e4bc65c8, 3.2.5, 28 MB, false, 9, 2878</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="scaling-etcd"><a class="anchor" href="#scaling-etcd"></a>Scaling etcd</h3>
<div class="paragraph">
<p>Scaling the etcd cluster can be performed vertically by adding more resources to
the etcd hosts, or horizontally by adding more etcd hosts.</p>
</div>
<div class="paragraph">
<p>If etcd is collocated on master instances, horizontally scaling etcd prevents
the API and controller services competing with etcd for resources.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Due to the voting system etcd uses, the cluster must always contain an odd
number of members.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The new host requires a fresh RHEL7 dedicated host. The etcd storage should be
located on an SSD disk to achieve maximum performance and ideally on a dedicated
disk mounted in <code>/var/lib/etcd</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>OpenShift Origin version 3.7 ships with an automated way to add a new etcd host
using Ansible.</p>
</div>
</td>
</tr>
</table>
</div>
<h2 id="prerequisites-3" class="discrete">Prerequisites</h2>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Before adding a new etcd host, perform a backup of both etcd configuration and
data to prevent data loss.</p>
</li>
<li>
<p>Check the current etcd cluster status to avoid adding new hosts to an
unhealthy cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># etcdctl --cert-file=/etc/etcd/peer.crt \
          --key-file=/etc/etcd/peer.key \
          --ca-file=/etc/etcd/ca.crt \
          --peers="https://*master-0.example.com*:2379,\
          https://*master-1.example.com*:2379,\
          https://*master-2.example.com*:2379"\
          cluster-health
member 5ee217d19001 is healthy: got healthy result from https://192.168.55.12:2379
member 2a529ba1840722c0 is healthy: got healthy result from https://192.168.55.8:2379
member ed4f0efd277d7599 is healthy: got healthy result from https://192.168.55.13:2379
cluster is healthy</pre>
</div>
</div>
<div class="paragraph">
<p>Or, using etcd v3 API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ETCDCTL_API=3 etcdctl --cert="/etc/etcd/peer.crt" \
          --key=/etc/etcd/peer.key \
          --cacert="/etc/etcd/ca.crt" \
          --endpoints="https://*master-0.example.com*:2379,\
            https://*master-1.example.com*:2379,\
            https://*master-2.example.com*:2379"
            endpoint health
https://master-0.example.com:2379 is healthy: successfully committed proposal: took = 5.011358ms
https://master-1.example.com:2379 is healthy: successfully committed proposal: took = 1.305173ms
https://master-2.example.com:2379 is healthy: successfully committed proposal: took = 1.388772ms</pre>
</div>
</div>
</li>
<li>
<p>Before running the <code>scaleup</code> playbook, ensure the new host is registered to
the proper Red Hat software channels:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager register \
    --username=*&lt;username&gt;* --password=*&lt;password&gt;*
# subscription-manager attach --pool=*&lt;poolid&gt;*
# subscription-manager repos --disable="*"
# subscription-manager repos \
    --enable=rhel-7-server-rpms \
    --enable=rhel-7-server-extras-rpms</pre>
</div>
</div>
<div class="paragraph">
<p>etcd is hosted in the <code>rhel-7-server-extras-rpms</code> software channel.</p>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="adding-a-new-etcd-host-using-ansible"><a class="anchor" href="#adding-a-new-etcd-host-using-ansible"></a>Adding a new etcd host using Ansible</h4>
<h2 id="procedure-12" class="discrete">Procedure</h2>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Modify the Ansible inventory file and create a new group named <code>[new_etcd]</code>
and add the new host. Then, add the <code>new_etcd</code> group as a child of the <code>[OSEv3]</code>
group:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[OSEv3:children]
masters
nodes
etcd
&lt;new_etcd&gt;

... [OUTPUT ABBREVIATED] ...

[etcd]
master-0.example.com
master-1.example.com
master-2.example.com

[new_etcd]
etcd0.example.com</pre>
</div>
</div>
</li>
<li>
<p>Run the etcd <code>scaleup</code> playbook from the host that executed the initial
installation and where the Ansible inventory file is:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ ansible-playbook  /usr/share/ansible/openshift-ansible/playbooks/byo/openshift-etcd/scaleup.yml</pre>
</div>
</div>
</li>
<li>
<p>Once the above has finished, modify the inventory file to reflect the current
status by moving the new etcd host from the <code>[new_etcd]</code> group to the <code>[etcd]</code>
group:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[OSEv3:children]
masters
nodes
etcd
&lt;new_etcd&gt;

... [OUTPUT ABBREVIATED] ...

[etcd]
master-0.example.com
master-1.example.com
master-2.example.com
etcd0.example.com</pre>
</div>
</div>
</li>
<li>
<p>If using Flannel, modify the <code>flanneld</code> service configuration, located at
<code>/etc/sysconfig/flanneld</code> on every OpenShift Origin host, to include the new etcd
host:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">FLANNEL_ETCD_ENDPOINTS=https://master-0.example.com:2379,https://master-1.example.com:2379,https://master-2.example.com:2379,*https://etcd0.example.com:2379*</pre>
</div>
</div>
</li>
<li>
<p>Restart the <code>flanneld</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart flanneld.service</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="manually-adding-a-new-etcd-host"><a class="anchor" href="#manually-adding-a-new-etcd-host"></a>Manually adding a new etcd host</h4>
<div class="paragraph">
<p>The following steps can be performed on any etcd member. If using the Ansible
installer, the first host provided in the <code>[etcd]</code> Ansible inventory is used to
generate the etcd configuration and certificates stored in
<code>/etc/etcd/generated_certs</code>, so perform the next steps in that etcd host.</p>
</div>
<div class="paragraph">
<p><strong>Steps to be performed on the current etcd cluster</strong></p>
</div>
<h2 id="procedure-13" class="discrete">Procedure</h2>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In order to create the etcd certificates, run the <code>openssl</code> command with the
proper values. To make this process easier, create some environment variables:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">export NEW_ETCD_HOSTNAME="*etcd0.example.com*"
export NEW_ETCD_IP="*192.168.55.21*"

export CN=$NEW_ETCD_HOSTNAME
export SAN="IP:${NEW_ETCD_IP}"
export PREFIX="/etc/etcd/generated_certs/etcd-$CN/"
export OPENSSLCFG="/etc/etcd/ca/openssl.cnf"</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The custom <code>openssl</code> extensions used as <code>etcd_v3_ca_*</code> include the
$SAN environment variable as <code>subjectAltName</code>. See <code>/etc/etcd/ca/openssl.cnf</code>
for more information.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create the directory where the configuration and certificates are stored:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir -p ${PREFIX}</pre>
</div>
</div>
</li>
<li>
<p>Create the server certificate request and sign it:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># openssl req -new -config ${OPENSSLCFG} \
    -keyout ${PREFIX}server.key  \
    -out ${PREFIX}server.csr \
    -reqexts etcd_v3_req -batch -nodes \
    -subj /CN=$CN

# openssl ca -name etcd_ca -config ${OPENSSLCFG} \
    -out ${PREFIX}server.crt \
    -in ${PREFIX}server.csr \
    -extensions etcd_v3_ca_server -batch</pre>
</div>
</div>
</li>
<li>
<p>Create the peer certificate request and sign it:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># openssl req -new -config ${OPENSSLCFG} \
    -keyout ${PREFIX}peer.key \
    -out ${PREFIX}peer.csr \
    -reqexts etcd_v3_req -batch -nodes \
    -subj /CN=$CN

# openssl ca -name etcd_ca -config ${OPENSSLCFG} \
  -out ${PREFIX}peer.crt \
  -in ${PREFIX}peer.csr \
  -extensions etcd_v3_ca_peer -batch</pre>
</div>
</div>
</li>
<li>
<p>Copy the current etcd configuration and <code>ca.crt</code> files from the current node
as examples to be modified later:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp /etc/etcd/etcd.conf ${PREFIX}
# cp /etc/etcd/ca.crt ${PREFIX}</pre>
</div>
</div>
</li>
<li>
<p>Add the new host to the etcd cluster. Note the new host is not configured yet
so the status stays as <code>unstarted</code> until the new host is properly configured:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># etcdctl2 member add ${NEW_ETCD_HOSTNAME} https://${NEW_ETCD_IP}:2380</pre>
</div>
</div>
<div class="paragraph">
<p>This command outputs the following variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">ETCD_NAME="&lt;NEW_ETCD_HOSTNAME&gt;"
ETCD_INITIAL_CLUSTER="&lt;NEW_ETCD_HOSTNAME&gt;=https://&lt;NEW_HOST_IP&gt;:2380,&lt;CLUSTERMEMBER1_NAME&gt;=https:/&lt;CLUSTERMEMBER2_IP&gt;:2380,&lt;CLUSTERMEMBER2_NAME&gt;=https:/&lt;CLUSTERMEMBER2_IP&gt;:2380,&lt;CLUSTERMEMBER3_NAME&gt;=https:/&lt;CLUSTERMEMBER3_IP&gt;:2380"
ETCD_INITIAL_CLUSTER_STATE="existing"</pre>
</div>
</div>
</li>
<li>
<p>Those values must be overwritten by the current ones in the sample
<code>${PREFIX}/etcd.conf</code> file. Also, modify the following variables with the new
host IP (<code>${NEW_ETCD_IP}</code> can be used) in that file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">ETCD_LISTEN_PEER_URLS
ETCD_LISTEN_CLIENT_URLS
ETCD_INITIAL_ADVERTISE_PEER_URLS
ETCD_ADVERTISE_CLIENT_URLS</pre>
</div>
</div>
</li>
<li>
<p>Modify the <code>${PREFIX}/etcd.conf</code> file and check for syntax errors or missing
IPs otherwise the etcd service could fail:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vi ${PREFIX}/etcd.conf</pre>
</div>
</div>
</li>
<li>
<p>Once the file has been properly modified, a <code>tgz</code> file with the certificates,
the sample configuration file, and the <code>ca</code> is created and copied to the new
host:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># tar -czvf /etc/etcd/generated_certs/${CN}.tgz -C ${PREFIX} .
# scp /etc/etcd/generated_certs/${CN}.tgz ${CN}:/tmp/</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Steps to be performed on the new etcd host</strong></p>
</div>
<div class="paragraph">
<p>The new host is required to be subscribed to the proper Red Hat software
channels as explained above in the prerequisites section.</p>
</div>
<h2 id="procedure-14" class="discrete">Procedure</h2>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install <code>iptables-services</code> to provide iptables utilities to open the required
ports for etcd:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install -y iptables-services</pre>
</div>
</div>
</li>
<li>
<p>Create firewall rules to allow etcd to communicate:</p>
<div class="ulist">
<ul>
<li>
<p>Port 2379/tcp for clients</p>
</li>
<li>
<p>Port 2380/tcp for peer communication</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl enable iptables.service --now
# iptables -N OS_FIREWALL_ALLOW
# iptables -t filter -I INPUT -j OS_FIREWALL_ALLOW
# iptables -A OS_FIREWALL_ALLOW -p tcp -m state --state NEW -m tcp --dport 2379 -j ACCEPT
# iptables -A OS_FIREWALL_ALLOW -p tcp -m state --state NEW -m tcp --dport 2380 -j ACCEPT
# iptables-save | tee /etc/sysconfig/iptables</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In this example, a new chain <code>OS_FIREWALL_ALLOW</code> is created, which is the
standard naming the OpenShift Origin installer uses for firewall rules.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the environment is hosted in an IaaS environment, modify the security groups
for the instance to allow incoming traffic to those ports as well.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Install etcd software:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install -y etcd</pre>
</div>
</div>
</li>
<li>
<p>Ensure the service is not running:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl disable etcd --now</pre>
</div>
</div>
</li>
<li>
<p>Remove any etcd configuration and data:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># rm -Rf /etc/etcd/*
# rm -Rf /var/lib/etcd/*</pre>
</div>
</div>
</li>
<li>
<p>Untar the certificates and configuration files</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># tar xzvf /tmp/*etcd0.example.com*.tgz -C /etc/etcd/</pre>
</div>
</div>
</li>
<li>
<p>Restore etcd configuration and data owner:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chown -R etcd.etcd /etc/etcd/
# chown -R etcd.etcd /var/lib/etcd/</pre>
</div>
</div>
</li>
<li>
<p>Start etcd on the new host:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl enable etcd --now</pre>
</div>
</div>
</li>
<li>
<p>Verify the host has been added to the cluster and the current cluster health:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># etcdctl --cert-file=/etc/etcd/peer.crt \
          --key-file=/etc/etcd/peer.key \
          --ca-file=/etc/etcd/ca.crt \
          --peers="https://*master-0.example.com*:2379,\
          https://*master-1.example.com*:2379,\
          https://*master-2.example.com*:2379,\
          https://*etcd0.example.com*:2379"\
          cluster-health
member 5ee217d19001 is healthy: got healthy result from https://192.168.55.12:2379
member 2a529ba1840722c0 is healthy: got healthy result from https://192.168.55.8:2379
member 8b8904727bf526a5 is healthy: got healthy result from https://192.168.55.21:2379
member ed4f0efd277d7599 is healthy: got healthy result from https://192.168.55.13:2379
cluster is healthy</pre>
</div>
</div>
<div class="paragraph">
<p>Or, using etcd v3 API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ETCDCTL_API=3 etcdctl --cert="/etc/etcd/peer.crt" \
          --key=/etc/etcd/peer.key \
          --cacert="/etc/etcd/ca.crt" \
          --endpoints="https://*master-0.example.com*:2379,\
            https://*master-1.example.com*:2379,\
            https://*master-2.example.com*:2379,\
            https://*etcd0.example.com*:2379"\
            endpoint health
https://master-0.example.com:2379 is healthy: successfully committed proposal: took = 5.011358ms
https://master-1.example.com:2379 is healthy: successfully committed proposal: took = 1.305173ms
https://master-2.example.com:2379 is healthy: successfully committed proposal: took = 1.388772ms
https://etcd0.example.com:2379 is healthy: successfully committed proposal: took = 1.498829ms</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Steps to be performed on all OpenShift Origin masters</strong></p>
</div>
<h2 id="procedure-15" class="discrete">Procedure</h2>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Modify the master configuration to add the new etcd host to the list of the
etcd servers OpenShift Origin uses to store the data, located in the
<code>etcClientInfo</code> section of the <code>/etc/origin/master/master-config.yaml</code> file on
every master:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">etcdClientInfo:
  ca: master.etcd-ca.crt
  certFile: master.etcd-client.crt
  keyFile: master.etcd-client.key
  urls:
    - https://master-0.example.com:2379
    - https://master-1.example.com:2379
    - https://master-2.example.com:2379
    *- https://etcd0.example.com:2379*</pre>
</div>
</div>
</li>
<li>
<p>Restart the master API service on every master:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart atomic-openshift-master-api</pre>
</div>
</div>
<div class="paragraph">
<p>Or, on a single master cluster installation</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart atomic-openshift-master</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The number of etcd nodes must be odd, so at least two hosts must be added.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If using Flannel, the <code>flanneld</code> service configuration located at
<code>/etc/sysconfig/flanneld</code> on every OpenShift Origin host must be modified to
include the new etcd host:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">FLANNEL_ETCD_ENDPOINTS=https://master-0.example.com:2379,https://master-1.example.com:2379,https://master-2.example.com:2379,*https://etcd0.example.com:2379*</pre>
</div>
</div>
</li>
<li>
<p>Restart the <code>flanneld</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart flanneld.service</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="removing-an-etcd-host"><a class="anchor" href="#removing-an-etcd-host"></a>Removing an etcd host</h3>
<div class="paragraph">
<p>An etcd host can fail beyond restoration. This section walks through removing
the failed etcd host from the cluster.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ensure the etcd cluster maintains quorum while removing the etcd host, by
removing a single host at a time from a cluster.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Steps to be performed on all masters hosts</strong></p>
</div>
<h2 id="procedure-16" class="discrete">Procedure</h2>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Edit the failed etcd host out of the <code>/etc/origin/master/master-config.yaml</code>
master configuration file on every master:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">etcdClientInfo:
  ca: master.etcd-ca.crt
  certFile: master.etcd-client.crt
  keyFile: master.etcd-client.key
  urls:
    - https://master-0.example.com:2379
    - https://master-1.example.com:2379
    *- https://master-2.example.com:2379* <i class="conum" data-value="1"></i><b>(1)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The host to be removed.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Restart the master API service on every master:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart atomic-openshift-master-api</pre>
</div>
</div>
<div class="paragraph">
<p>Or, if using a single master cluster installation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart atomic-openshift-master</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Steps to be performed in the current etcd cluster</strong></p>
</div>
<h2 id="procedure-17" class="discrete">Procedure</h2>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Remove the failed host from the cluster by running the following on a
functioning etcd host:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># etcdctl2 cluster-health
member 5ee217d19001 is healthy: got healthy result from https://192.168.55.12:2379
member 2a529ba1840722c0 is healthy: got healthy result from https://192.168.55.8:2379
failed to check the health of member 8372784203e11288 on https://192.168.55.21:2379: Get https://192.168.55.21:2379/health: dial tcp 192.168.55.21:2379: getsockopt: connection refused
member 8372784203e11288 is unreachable: [https://192.168.55.21:2379] are all unreachable
member ed4f0efd277d7599 is healthy: got healthy result from https://192.168.55.13:2379
cluster is healthy

# etcdctl2 member remove 8372784203e11288
Removed member 8372784203e11288 from cluster

# etcdctl2 cluster-health
member 5ee217d19001 is healthy: got healthy result from https://192.168.55.12:2379
member 2a529ba1840722c0 is healthy: got healthy result from https://192.168.55.8:2379
member ed4f0efd277d7599 is healthy: got healthy result from https://192.168.55.13:2379
cluster is healthy</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>remove</code> command requires the etcd ID, not the hostname.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>To ensure the etcd configuration does not use the failed host when the etcd
service is restarted, modify the <code>/etc/etcd/etcd.conf</code> file on all remaining
etcd hosts and remove the failed host in the value for the
<code>ETCD_INITIAL_CLUSTER</code> variable:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vi /etc/etcd/etcd.conf</pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">ETCD_INITIAL_CLUSTER=master-0.example.com=https://192.168.55.8:2380,master-1.example.com=https://192.168.55.12:2380,master-2.example.com=https://192.168.55.13:2380</pre>
</div>
</div>
<div class="paragraph">
<p>becomes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">ETCD_INITIAL_CLUSTER=master-0.example.com=https://192.168.55.8:2380,master-1.example.com=https://192.168.55.12:2380</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Restarting the etcd services is not required, because the failed host has been
removed using <code>etcdctl</code> on the command line.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Modify the Ansible inventory file to reflect the current status of the cluster
and to avoid issues if running a playbook:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[OSEv3:children]
masters
nodes
etcd

... [OUTPUT ABBREVIATED] ...

[etcd]
master-0.example.com
master-1.example.com</pre>
</div>
</div>
</li>
<li>
<p>If using Flannel, modify the <code>flanneld</code> service configuration located at
<code>/etc/sysconfig/flanneld</code> on every host and remove the etcd host:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">FLANNEL_ETCD_ENDPOINTS=https://master-0.example.com:2379,https://master-1.example.com:2379,https://master-2.example.com:2379</pre>
</div>
</div>
</li>
<li>
<p>Restart the <code>flanneld</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart flanneld.service</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="replacing-an-etcd-host"><a class="anchor" href="#replacing-an-etcd-host"></a>Replacing an etcd host</h4>
<div class="paragraph">
<p>To replace an etcd host, first remove the etcd node from the cluster following
the steps from
<a href="../day_two_guide/host_level_tasks.html#removing-an-etcd-host">Removing an
etcd host</a>, then scale up the etcd cluster with the new host using the scale up
Ansible playbook or the manual procedure in
<a href="../day_two_guide/host_level_tasks.html#scaling-etcd">Scaling etcd</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The etcd cluster should maintain a quorum during the replacement operation. This
means that at least one host should be in operation at all times.</p>
</div>
<div class="paragraph">
<p>If the host replacement operation occurs while the etcd cluster maintains a
quorum, cluster operations are not affected, except if there is a large etcd
data to replicate where some operations can be slowed down.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ensure a backup of etcd data and configuration files exists before any procedure
involving the etcd cluster to ensure restoration in the case of failure.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
      </div>
    </div>
  </div>
  <script type="text/javascript">
    /*<![CDATA[*/
    $(document).ready(function() {
      $("[id^='topicGroup']").on('show.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicGroup']").on('hide.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicSubGroup']").on('show.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
      $("[id^='topicSubGroup']").on('hide.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
    });
    /*]]>*/
  </script>
    <footer class="footer-origin-docs">
  <div class="container">
    <div class="row">
      <div class="col-sm-12">
        <div id="footer_social">
          <a href="https://twitter.com/openshift" class="first">
            <span>
              <i class="fa fa-twitter-square fa-2x fa-inverse"></i>
            </span>
          </a>
          <a href="https://github.com/openshift/origin">
            <span>
              <i class="fa fa-github fa-2x fa-inverse"></i>
            </span>
          </a>
          <a href="https://plus.google.com/communities/114361859072744017486">
            <span>
              <i class="fa fa-google-plus-square fa-2x fa-inverse"></i>
            </span>
          </a>
          <a href="https://www.facebook.com/openshift">
            <span>
              <i class="fa fa-facebook-square fa-2x fa-inverse"></i>
            </span>
          </a>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-xs-12 col-sm-4">
        <a id="footer_logo" href="https://www.redhat.com/">
          <img alt="Red Hat" src="https://assets.openshift.net/app/assets/redhat.svg">
        </a>
      </div>
      <div class="col-xs-12 col-sm-4 text-center">
        <a id="powered_by_openshift" title="Powered by OpenShift Online with the DIY Cartridge" href="https://hub.openshift.com/quickstarts/92-do-it-yourself-0-1">
          <img src="https://www.openshift.com/sites/default/files/images/powered-transparent-white.png" alt="Powered by OpenShift Online">
        </a>
      </div>
      <div class="col-xs-12 col-sm-4 text-right">
        <a id="built_with_asciibinder" title="Built with AsciiBinder docs management system" href="http://asciibinder.org/">
          <img src="../../go-client-preview/_images/asciibinder_web_logo.svg" alt="AsciiBinder">
        </a>
      </div>
    </div>
    <div class="row">
      <div class="col-lg-12">
        <div class="attribution">
          <button type="button" class="btn btn-link" data-html="true" data-container="body" data-toggle="popover" data-placement="top" data-content="
            '<a target='_blank' href='https://www.flickr.com/photos/eflon/3655695161/'>Spin</a>' by <a target='_blank' href='https://www.flickr.com/photos/eflon/'>eflon</a>,</br> used under <a target='_blank' href='https://creativecommons.org/licenses/by/2.0/'>CC BY 2.0</a> </br>Color tint added to original">
            Image attribution
          </button>
        </div>
      </div>
    </div>
    <script>
    $(function () {
      $('[data-toggle="popover"]').popover()
    })
    </script>
  </div>
</footer>
</body>
</html>